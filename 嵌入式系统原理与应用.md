![IMAGE](media/image1.jpeg){width="8.26388888888889in"
height="11.694444444444445in"}

> 通用微机计算机系统就是看得见的计算机,包括硬件和软件,PC机、服务器、大型计,
> 算机等。微型计算机系统组成示意图如图1.2所示。
>
> 微型计算机系统

E\|

设\|件 电\|备\| 路 系

> 硬件系统
>
> 图1.2 微型计算机系统组成示意图
>
> 技术要求:高速计算+海量存储。
>
> 发展方向: CPU速度不断提升,存储容量不断扩大
>
> 分支二:嵌入式计算机系统ECS(Embedded Computer
> System)-能嵌入对象体系中,以
> 实现对象体系智能化为目的的一类专用计算机系统
>
> 技术要求:必须满足对象体系的物理、电气和环境以及产品成本等要求
>
> 发展方向:与对象系统密切相关的嵌入性能、控制能力与控制可靠性。
>
> 比如:工业计算机(Industrial Personal Computer),如图1.3所示。
>
> ![](media/image2.jpeg)
>
> 图1.3 工业计算机
>
> ![](media/image3.jpeg)

![IMAGE](media/image1.jpeg){width="8.26388888888889in"
height="11.694444444444445in"}

![](media/image4.jpeg)

> 第1章 嵌入式系统概述
>
> 单片机学习一般从硬件入手,从硬件体系结构、汇编语言到硬件设计、软件设计。
>
> 嵌入式系统学习可以从软件入手,从应用层编程到操作系统移植、硬件平台设计较好,接
> 单片机设计的学习流程较难掌握。
>
> (3)通用计算机与嵌入式系统特征的对比见表1-1。.
>
> 表1-1 通用计算机与嵌入式系统特征对比表

+---------+--------------------------------+---------------------------+
| > 特征  | > 通用计算机                   | > 嵌入式系统              |
+---------+--------------------------------+---------------------------+
| > 形式  | > 看得见的计算机               | > 看不见的计算机          |
| 和类型  | > 按其体系结                   | > 形式多样                |
|         | 构、运算速度和结构规模等因素分 | ,应用领域广泛,按应用来分  |
|         | > 为大、中、小型机和微机       |                           |
+---------+--------------------------------+---------------------------+
| > 组成  | > 通用处理器、标准总线和外设。 | > 面向应用                |
|         | > 软件和硬件相对独立           | 的嵌入式微处理器,总线和外 |
|         |                                | >                         |
|         |                                | > 部                      |
|         |                                | 接口多集成在处理器内部。  |
|         |                                | >                         |
|         |                                | > 软 件 与硬 件 是 紧密   |
|         |                                | > 集 成 在 一起           |
+---------+--------------------------------+---------------------------+
| > 开    | > 开                           | > 采用交叉                |
| 发方式  | 发平台和运行平台都是通用计算机 | 开发方式,开发平台一般是通 |
|         |                                | > 用计                    |
|         |                                | 算机,运行平台是嵌入式系统 |
+---------+--------------------------------+---------------------------+
| > 次    | > 应用程序可重新编制           | > 般不能再编程            |
| 开发性  |                                |                           |
+---------+--------------------------------+---------------------------+

> 2.嵌入式系统与PC的区另
>
> (1)嵌入式系统不同于PC.
>
> 嵌入式系统一般是专用系统,而PC是通用计算平台
> 嵌入式系统的资源比PC少得多;
>
> 嵌入式系统软件故障带来的后果比PC大得多;
> 嵌入式系统一般采用实时操作系统; 嵌入式系统大都有成本、功耗的要求;
> 嵌入式系统得到多种微处理体系的支持; 嵌入式系统需要专用的开发工具。
>
> (2)嵌入式系统与PC对比见表1-2.
>
> 表1-2嵌入式系统与PC对比表

+----------+---------------------------+------+----+----+---+---+--------+
| > 特征   | > 嵌入式系统              |      |    | >  |   |   |        |
|          |                           |      |    | PO |   |   |        |
+----------+---------------------------+------+----+----+---+---+--------+
| >        | > Bootloader 引号         | > 针 |    |    |   |   |        |
| 引导代码 |                           | 对不 |    |    |   |   |        |
|          |                           | 同电 |    |    |   |   |        |
|          |                           | 路进 |    |    |   |   |        |
|          |                           | 行移 |    |    |   |   |        |
|          |                           | 植主 |    |    |   |   |        |
|          |                           | 板的 |    |    |   |   |        |
|          |                           | BIOS |    |    |   |   |        |
|          |                           | 引导 |    |    |   |   |        |
+----------+---------------------------+------+----+----+---+---+--------+
| > Os     | > Wince. Vxworks,         |      | >  | >  | 不 | 移 | 植   |
|          | > Linux等,需要移植        |      |  W |  L |   |   |        |
|          |                           |      | in | in |   |   |        |
|          |                           |      | do | ux |   |   |        |
|          |                           |      | w, |    |   |   |        |
|          |                           |      | >  |    |   |   |        |
|          |                           |      |  - |    |   |   |        |
+----------+---------------------------+------+----+----+---+---+--------+
| >        | > 每个设备                | > OS | >  | >  | > |   |        |
| 驱动程序 | 都必须针对电路板进行开发  |      | 中 | 大 |   |   |        |
|          |                           |      | 含 | 多 | 直 |  |        |
|          |                           |      | 有 | 数 | 接 |  |        |
|          |                           |      |    | ,  | 下 |  |        |
|          |                           |      |    |    | 奉 |  |        |
+----------+---------------------------+------+----+----+---+---+--------+
| > 协议栈 | > 移植                    |      | OS |    |   |   |        |
|          |                           |      | 或 |    |   |   |        |
|          |                           |      | 第 |    |   |   |        |
|          |                           |      | 三 |    |   |   |        |
|          |                           |      | 方 |    |   |   |        |
|          |                           |      | 供 |    |   |   |        |
|          |                           |      | 应 |    |   |   |        |
|          |                           |      | 商 |    |   |   |        |
|          |                           |      | 提 |    |   |   |        |
|          |                           |      | 供 |    |   |   |        |
+----------+---------------------------+------+----+----+---+---+--------+
| >        | > 借助服务器进行交叉编译  |      | >  |    | > |   |        |
| 开发环填 |                           |      | 本 |    |   |   |        |
|          |                           |      | 机 |    | 调 |  |        |
|          |                           |      |    |    | 试 |  |        |
+----------+---------------------------+------+----+----+---+---+--------+
| > 仿真器 | > 需要                    |      |    | >  |   |   |        |
|          |                           |      |    | 不 |   |   |        |
|          |                           |      |    | 需 |   |   |        |
|          |                           |      |    | 要 |   |   |        |
+----------+---------------------------+------+----+----+---+---+--------+

> 1.1.4 嵌入式系统分类
>
> 嵌入式系统种类繁多,应用广泛,从嵌入式处理器、嵌入式系统应用、嵌入式系统的实时
> 性及操作系统特点进行简单分类。
>
> 1,按嵌入式处理器的位数来分类
>
> (1)4位嵌入式系统
>
> 嵌入式系统原理与应用
>
> \(2\) 8位嵌入式系统:
>
> \(3\) 16位嵌入式系统
>
> \(4\) 32位嵌入式系统
>
> \(5\) 64位嵌入式系统
>
> 8位和16位嵌入式系统是目前市场使用比较广泛的,
> 32位嵌入式系统正成为主流发展趋 势,
> 64位高度复杂的、高速的嵌入式系统,则刚开始采用.
>
> 2.按应用来分类
>
> (1)工业控制。基于嵌入式系统的工业自动化设备将获得长足的发展,比如在机床、治金、
> 电子、交通和航空航天等行业的应用。
>
> (2)交通管理。在车辆导航、流量控制、信息监测与汽车服务方面,嵌入式系统技术已经
> 获得了广泛的应用,内嵌GPS模块、GSM模块的移动定位终端已经在各种运输行业获得了成
> 功的使用。目前, GPS设备已经从尖端产品列入大众消费产品,
>
> (3)信息家电。冰箱、空调等的网络化、智能化将引领人们的生活步入一个崭新的空间。
> 即使用户不在家里,也可以通过电话、网络进行远程控制。在这些设备中,嵌入式系统将大有
> 用武之地
>
> (4)家庭智能管理。水、电、煤气表的远程自动抄表,安全防火、防盗系统,其中嵌有的
> 专用控制芯片将代替传统的人工检查,并具有更高、更准确和更安全的性能。目前在服务领域,
> 如远程点菜器等已经体现了嵌入式系统的优势
>
> 3,按速度来分类
>
> 根据响应速度,嵌入式系统可分为强实时、一般实时和弱实时系统。
>
> (1)强实时系统,其系统响应时间在毫秒或微秒级
>
> (2)一般实时系统,其系统响应时间在几秒的数量级上,实时性的要求比强实时系统要差一些,
>
> (3)弱实时系统,其系统响应时间约为数十秒或更长。这种系统的响应时间可能随系统负
> 载的轻重而变化
>
> 1,按确定性来分类
>
> 根据确定性的强弱,可将嵌入式系统分为硬实时、软实时系统。
>
> (1)硬实时系统,系统对系统响应时间有严格的要求,如果系统响应时间不能满足,就会
>
> 1引起系统崩溃或致命的错误。
>
> (2)软实时系统,系统对系统响应时间有要求,但是如果系统响应时间不能满足,不会导
> 致系统出现致命的错误或崩溃。
>
> 5·根据操作系统对任务的处理流程来分类
>
> (1)循环轮询系统
>
> (2)有限状态机系统
>
> (3)前后台系统：
>
> (4)单处理器多任务系统;
>
> (5)多处理器多任务系统。
>
> 6

![](media/image5.jpeg)

> 1.2.1 嵌入式系统硬件组成

嵌入式系统的硬件以嵌入式微处理器为核心,主要由嵌入式微处理器、总线、存储器及输
入/输出接口和设备组成,如图1.7所示.

> (1)嵌入式微处理器。每个嵌入式系统至少包含一个嵌入式微处理器,嵌入式微处理器体
> 系结构可采用冯诺依曼结构或哈佛结构;指令系统可采用精简指令集或复杂指令集。嵌入式
> 微处理器是由通用微处理器发展来的。与通用微处理器相比,它具有体积小、集成度高、可靠
> 性高等自身特点。
>
> ![IMAGE](media/image6.jpeg){width="2.2222222222222223in"
> height="1.8472222222222223in"}
>
> 图1.7 嵌入式系统硬件组成
>
> (2)嵌入式系统外围设备组成。外围设备是指在一个嵌入式系统中,除了嵌入式处理器以
> 外的完成存储、通信、调试、显示等辅助功能的其他部件。
>
> 根据外围设备的功能可将外围设备分为以下三类;
>
> 1)存储器设备:静态易失型存储器(RAM,
> SRAM)、动态存储器(DRAM)和非易失型存储 器(Flash),其中,
> Flash以可擦写次数多、存储速度快、容量大及价格低等优点在嵌入式领域
> 得到了广泛的应用。
>
> 2)接口设备:应用广泛的包括并口、RS-232串口、IrDA红外接口、SPI串行外围设备接
> 口、12CInter IC)总线接口、USB通用串行总线接口、Ethernet网口等
>
> 3)人机交互设备: LCD、键盘和触摸屏等人机交互设备。
>
> 1.2.2 嵌入式系统软件组成

嵌入式软件系统由系统软件和应用软件组成,从底层到应用层更详细的划分为板级支持包
(BSP)、底层驱动(Driver)、操作系统内核和应用程序,如图1.8所示.

> 图1.8 嵌入式系统软件组成

![IMAGE](media/image7.jpeg){width="6.25in"
height="3.4027777777777777in"}

> 1.3嵌入式处理器简介
>
> 嵌入式处理器是嵌入式系统的核心部件。嵌入式处理器与通用处理器的最大不同点在于嵌入
> 式处理器大多工作在为特定用户群设计的系统中。它通常把通用计算机中许多由板卡完成的任务
> 集成在芯片内部,从而有利于嵌入式系统设计趋于小型化,并具有高效率、高可靠性等特征。
>
> 大的硬件厂商会推出自己的嵌入式处理器,因而市面上现在有1000多种嵌入式处理器芯
> 片,其中使用广泛的有ARM, MIPS, PowerPC, MC68000等
>
> 嵌入式系统的核心是嵌入式微处理器,嵌入式微处理器一般具备以下特点。
>
> (1)对实时多任务系统有很强的支持能力,能完成多任务并且有较短的中断响应时间,从
> 而使内部的代码和实时内核的执行时间减少到最低限度。
>
> (2)具有功能很强的存储区保护功能。这是由于嵌入式系统的软件结构已经模块化,而为
> 了避免在软件模块之间出现错误的交叉作用,需要设计强大的存储区保护功能,同时也有利于
> 软件诊断
>
> (3)可扩展的处理器结构,能最迅速地开发出满足应用的最高性能的嵌入式微处理器。
>
> (4)功耗很低,尤其是用于便携式的无线及移动的计算和通信设备中靠电池供电的嵌入式
> 系统更是如此,通常功耗只有毫瓦甚至微瓦级。
>
> 1.3.1 嵌入式微处理器分类
>
> 根据嵌入式系统中采用的CPU不同,嵌入式处理器可以分可以分为嵌入式微控制器、嵌
> 入式DSP处理器、嵌入式微处理器MPU和嵌入式片上系统SoC四类
>
> 1,嵌入式微控制器
>
> 嵌入式微控制器的典型代表是单片机,这种8位的电子器件目前在嵌入式设备中仍然有着
> 极其广泛的应用。单片机芯片内部集成ROM/EPROM,
> RAM、总线、总线逻辑、定时/计数器,
>
> 10

看门狗、1/O、串行口、脉宽调制输出、AD. D/A. Flash RAM.
EEPROM等各种必要功能和 外设,如图1.10所示。

> 1.10 单片机模块图

微控制器的最大特点是单片化,体积大大减小,功耗和成本降低、可靠性提高。它是目前
嵌入式系统工业的主流。微控制器的片上外设资源一般比较丰富,适合于控制系统,因此称头
微控制器。

> 2,嵌入式DSP处理器
>
> DSP处理器是专门用于信号处理方面的处理器,其在系统结构和指令算法方面进行了特殊
> 设计,在数字滤波、FFT、谱分析等各种仪器上DSP获得了大规模的应用

DSP的理论算法在20世纪70年代就已经出现,但是由于专门的DSP处理器还未出现,
所以这种理论算法只能通过MPU等由分立元件实现。1982年,世界上诞生了首校DSP芯片,
在语音合成和编码解码器中得到了广泛应用。DSP的运算速度进一步提高,应用领域也从上
述范围扩大到了通信和计算机方面。

目前最为广泛应用的嵌入式DSP处理器是TI的TMS320C2000/C5000系列,另外如Inte
的MCS-296和Siemens的TriCore也有各自的应用范围,

> 3·嵌入式微处理器(Micro Processor Unit, MPU

嵌入式微处理器是由通用计算机中的CPU演变而来的。与计算机处理器不同的是,在穷
际嵌入式应用中,只保留和嵌入式应用紧密相关的功能硬件,去除其他的冗余功能部分,这样
就以最低的功耗和资源实现嵌入式应用的特殊要求。

> 和工业控制计算机相比,嵌入式微处理器具有体积小、质量轻、成本低、可靠性高的优点。
> 目前主要的嵌入式处理器类型有Am186/88, 386EX, SC-400, PowerPC, X86,
> MIPS,
>
> ARM/StrongARM系列等
>
> 4,嵌入式片上系统(System on Chip, Soc

SoC嵌入式系统微处理器就是一种电路系统。它结合了许多功能区块,将功能做在一个芯
片上,像是ARM RISC, MIPS RISC,
DSP或是其他的微处理器核心,加上通信的接口单元,
像是通用串行端口(USB)、TCP/IP通信单元、GPRS通信接口、GSM通信接口、IEEE1394、
蓝牙模块接口,等等,这些单元以往都是依照各单元的功能做成一个个独立的处理芯片的

> SoC是追求产品系统最大包容的集成器件,SoC最大的特点是成功实现了软硬件的无缝结
> 合,直接在处理器片内嵌入操作系统的代码模块,如图1.11所示。
>
> 由于SoC往往是专用的,所以大部分内部结构和形成不为用户所知,如Philips的Smart
>
> 嵌入式系统原理与应用
>
> XA,少数通用系列如Siemens的TriCore, Motorola的M-Core,某些ARM系列器件,
> Echelon
> 和Motorola联合研制的Neuron芯片等。SoC芯片也将在声音、图像、影视、网络及系统逻辑
> 等应用领域中发挥重要作用。
>
> SoC嵌入式系统微处理器所具有的其他优点如下:
>
> (1)利用改变内部工作电压,降低芯片功耗
>
> (2)减少芯片对外管脚数,简化制造过程。
>
> (3)减少外围驱动接口单元及电路板之间的信号传递,可以加快微处理器数据处理的速度。
>
> (4)内嵌的线路可以避免外部电路板在信号传递时所造成系统杂讯。
>
> ![IMAGE](media/image8.jpeg){width="3.7083333333333335in"
> height="1.5416666666666667in"}
>
> 图1.11 Soc内核模块图
>
> Soc的关键技术主要包括总线架构技术、IP核可复用技术、软硬件协同设计技术、SoC验
> 证技术、可测性设计技术、低功耗设计技术、超深亚微米电路实现技术等,其中IP技术如下:
>
> IP核(ntellectual
> Property,知识产权)是一段具有特定电路功能的硬件描述语言程序,该
> 程序与集成电路工艺无关,可以移植到不同的半导体工艺中去生产集成电路芯片。利用IP核
> 设计电子系统,引用方便,修改基本元件的功能容易。一般将电路中常用但比较复杂的功能块,
> 如FIR滤波器、SDRAM控制器、PCI接口等设计成可修改参数的IP核。
>
> IP核的重用是设计人员赢得迅速上市时间的主要策略。随着CPLD/FPGA的规模越来赴
> 大,设计越来越复杂,设计者的主要任务是在规定的时间周期内完成复杂的设计,调用IP核
> 能避免重复劳动,大大减轻工程师的负担,因此使用IP核是一个发展趋势。
>
> 1.3.2 典型的嵌入式微处理器
>
> 常用的嵌入式微处理器包括ARM处理器、MIPS处理器、PowerPC处理器、MC68K/Coldfir
> 处理器、x86处理器
>
> 1\. ARM处理器
>
> ARM(Advanced RISC
> Machines)公司是全球领先的RISC微处理器IP设计供应商。ARM
> 处理器有以下三大特点：
>
> (1)小体积、低功耗、低成本而高性能;
>
> \(2\) 16/32位双指令集;
>
> (3)全球众多的合作伙伴。
>
> ARM系列处理器分ARM7, ARM9, ARMOE, ARMIOE, ARM11, SecurCore系列和Cortex
> 系列. Cortex系列处理器又分为Cortex-M, Cortex-R和Cortex-A.
>
> 2\. MIPS处理器

MIPS(Microprocessor without Interlocked Pipeline
Stages)技术公司是一家设计制造高性
能、高档次嵌入式32位和64位处理器的厂商。MIPS的定位很广,在高端市场它有64位的
20Kc系列,在低端市场有SmartMIPs系列。

> 3\. PowerPC处理器
>
> PowerPC处理器体系结构的特点是可伸缩性好,方便灵活。PowerPC处理器品种很多,既
> 有通用的处理器,又有微控制器和内核。其应用范围非常广泛,从高端的工作站、服务器到泉
> 面计算机系统,从消费类电子产品到大型通信设备,无所不包。
>
> 基于PowerPC架构的处理器有IBM公司开发的PowerPC 405
> GP,它是一个集成10/100Mb/
> 以太网控制器、串行和并行端口、内存控制器以及其他外设的高性能嵌入式处理器,
>
> 4\. MC68K/Coldfire处理器

68K是美国摩托罗拉公司出品的68000处理器的俗称,也是一种处理器架构。68K的最初
型号为MC68000,与其衍生的MC680X0一系列处理器,统称为68K系列,与Intel英特尔公
司的80×86系列对应。比如, Apple机以前使用的就是Motorola
68000,比Intel公司的808
还要早。ColdFire系列家族最早起源于摩托罗拉的68K系列处理器,至今与68K系列处理器
有着非常好的继承性和连贯性,
68K/ColdFire产品在欧美地区应用一直非常广泛,而国内公司 对
68K/ColdFire产品并不熟悉,大多是跨国大型企业在国内的分公司才会熟悉。

> 5\. ×86处理器
>
> x86系列处理器是最常用的,它起源于Intel架构的8080,发展到现在Pentium 4,
> Athlon 和AMD的64位处理器Hammer. 486DX是当时和ARM, 68K, MIPS,
> SuperH齐名的五大 嵌入式处理器之
>
> 1.4嵌入式操作系统
>
> 1.4.1 操作系统的发展

计算机系统由硬件和软件构成,在发展初期并没有操作系统这个概念,用户通过使用监控程
序来使用计算机。随着计算机技术的发展,计算机系统的硬件、软件资源越来越丰富,监控程序
已不能适应计算机应用的要求。于是,在20世纪60年代中期监控程序进一步发展形成了操作系
统。到目前为止,主流的操作系统有三种:多道批处理、分时和实时操作系统,如图1.12所示。

+---+----------------------------------+--------------------------------+
|   |                                  |                                |
+---+----------------------------------+--------------------------------+
|   | > 道批处理标                     | > 适用于计算中心等较大         |
|   |                                  | > 的计算机系统                 |
+---+----------------------------------+--------------------------------+
|   |                                  | > 适用于多个用户共享案 统资源  |
+---+----------------------------------+--------------------------------+
|   | > 分时作系统                     |                                |
+---+----------------------------------+--------------------------------+
|   |                                  | > 适用于嵌入或设备和有         |
|   |                                  | > 实时性要求的系统中           |
+---+----------------------------------+--------------------------------+
|   | > 实时操作系统                   |                                |
+---+----------------------------------+--------------------------------+

> 间
>
> 实时标作系统是 我们介绍的重点

![IMAGE](media/image1.jpeg){width="8.26388888888889in"
height="11.694444444444445in"}

![](media/image9.jpeg)

![](media/image10.jpeg)

![](media/image11.jpeg)

> 嵌入式系统原理与应用
>
> 1.5.2 发展趋势
>
> 1,嵌入式系统开发的工作重点正在向软件转移
>
> 以机械控制系统为例,
> 10年前机械、硬件和软件在机电系统中所占的比例分别是65%.
> 20%和15%,而现在在EMS中则是30%, 15%和55%。
>
> 硬件的发展趋势:更小-嵌入式处理器小型化
>
> 软件的发展趋势:更"聪明"-嵌入式应用软件智能化。
>
> 系统的发展趋势:更"紧密"\--嵌入式通信接口网络化。
>
> 2,基于组件的嵌入式系统软件开发的优点
>
> (1)可以选用商业成熟的软件组件
>
> (2)可以重用以往经过测试的高可靠性软件模块;
>
> (3)提高软件质量、缩短产品面市时间;
>
> (4)降低成本、减少费用。
>
> 3.硬件设计软件化
>
> 可编程芯片在嵌入式系统设计中的应用促进了硬件设计向软件设计发展 对象:
> FPGA, CPLD, ASIC.
>
> 工具: VHDL, veilog.
>
> 编程:硬件工程师。
>
> 本章主要介绍了嵌入式系统的概念、嵌入式系统的组成、嵌入式处理器、嵌入式操作系统
> 及嵌入式系统的应用等。通过本章的学习,学生可对嵌入式系统的组成、嵌入式系统的应用领
> 域等有一定的了解和认识。
>
> 1,简述嵌入式系统与其他系统的区别。
>
> 2.上网查找当今比较流行的嵌入式微处理器和嵌入式操作系统有哪些?至少列出5种以上。
>
> 3,简述嵌入式处理器分类
>
> 18
>
> 在传统的桌面处理器中, Intel一直占有主要地位,但在嵌入式设备中,
> ARM系列处理器
> 以其体积小、功耗低、性能高、成本低等优点,几乎占领了嵌入式处理器市场。本章将学\>
> ARM体系结构的特征及发展、ARM处理器简介、ARM
> Cortex-M内核的STM32F40x系列微
> 控制器的内部结构及开发方法。通过本章学习可以初步了解ARM公司、ARM体系结构的特
> 征及发展、ARM处理器系列、ARM
> Cortex系列处理器的特征及其应用,并且能够掌握
> STM32F40x系列为控制的内部结构及其开发工具和开发方法。
>
> 2.1 ARM体系结构的特征及发展

2.1.1 ARM简价

> ARM是Advanced RISC
> Machines的缩写,公司诞生于1986年,它是一家微处理器行业
> 的知名企业,该企业设计了大量高性能、廉价、耗能低的RISC(精简指令集)处理器。
>
> ARM内核是一种16/32位双指令RISC微控制器内核,它已成为移动通信、手持计算
> 多媒体数字消费等嵌入式解决方案的RISC标准,也就是业界公认的嵌入式微控制器的标准。
>
> ARM公司的特点是只设计芯片而不生产。它将技术授权给世界上许多著名的半导体、较
> 件和OEM厂商,并提供服务,ARM公司商业模式的强大之处在于其价格合理,全世界范围
> 内有超过100个合作伙伴。
>
> ARM的合作伙伴分为以下三种:
>
> 1\)
> EDA伙伴计划。融合了ARM在线系统设计、可重复使用IP生成和IP模型等方面的专
> 长与领先EDA工具厂商的专业特长,开发SoC产品。
>
> 2\)
> ARM技术共享计划。为ARM与外部设计服务公司合作关系的扩展和规范化结果,现
> 在已经有2900多工程师成员。
>
> 3)制造商计划。使新兴市场的OEM能分享ARM处理器技术,用于设计和制造先进的
> SoC解决方案
>
> ARM公司的授权模式如图2.1所示。
>
> ![](media/image12.jpeg)

![](media/image13.jpeg)

> 第2章 ARM处理器
>
> 3)简单的寻址模式;
>
> 4)统一和固定长度的指令域,简化了指令的译码,便于指令流水线设计:
>
> 5)在Thumb体系结构中以高密度16位压缩形式表示指令集。
>
> ARM体系结构的特点如下:
>
> 1)每条数据处理指令都对算术逻辑单元和移位器控制,实现了ALU和移位器的最大利用;
>
> 2)地址自动增加和减少寻址模式,优化程序循环;
>
> 3)多寄存器装载和存储指令实现最大数据吞吐量;
>
> 4)所有指令的条件实现最快速的代码执行
>
> 2\. ARM体系架构
>
> 传统的微处理器采用的冯。诺依曼结构将指令和数据存放在同一存储空间中进行统一编
> 址,指令和数据通过同一总线访问。
>
> 哈佛结构则是不同于冯诺依曼结构的一种并行体系结构,其主要特点是程序和数据存储
> 在不同的存储空间中，即程序存储器和数据存储器是两个相互独立的存储器，每个存储器独立
> 编址、独立访问。与之相对应的是系统中设置的两条总线(程序总线和数据总线),从而使数拒
> 的吞吐率提高为原来的两倍。
>
> 每个嵌入式系统至少包含一个嵌入式微处理器,
> ARM处理器体系结构可采用冯。诺依曼 (Von
> Neumann)结构或哈佛(Harvard)结构,如图2.4所示。
>
> ![IMAGE](media/image14.jpeg){width="3.6805555555555554in"
> height="1.1666666666666667in"}
>
> 图2.4 ARM体系结构图
>
> 3\. ARM体系结构指令系统
>
> ARM体系结构指令系统可采用以下两种指令集系统:
>
> 1)精简指令集系统RISC(Reduced Instruction Set Computer)
>
> 2)复杂指令集系统CISC(Complex Instruction Set Computer

+---------+---+-----------+-----------------+---------+--------------+
| > 类别  |   | > 表2-1   |                 |         | > RISC       |
|         |   | > CISC与R |                 |         |              |
|         |   | ISC对比表 |                 |         |              |
|         |   | > S০      |                 |         |              |
+---------+---+-----------+-----------------+---------+--------------+
| > 指    | > |           |                 | >       |              |
| 令系统  |   |           |                 |  指令数 |              |
|         | 指 |          |                 | 量较少  |              |
|         | 令 |          |                 | ,通常少 |              |
|         | 数 |          |                 | 于100条 |              |
|         | 量 |          |                 |         |              |
|         | 很 |          |                 |         |              |
|         | 多 |          |                 |         |              |
+---------+---+-----------+-----------------+---------+--------------+
| > 执    | > |           |                 | > 没有  |              |
| 行时间  |   |           |                 | 较长执  |              |
|         | 有 |          |                 | 行时间  |              |
|         | 些 |          |                 | 的指令  |              |
|         | 指 |          |                 |         |              |
|         | 令 |          |                 |         |              |
|         | 执 |          |                 |         |              |
|         | 行 |          |                 |         |              |
|         | 时 |          |                 |         |              |
|         | 间 |          |                 |         |              |
|         | 很 |          |                 |         |              |
|         | 长 |          |                 |         |              |
|         | , |           |                 |         |              |
|         | 如 |          |                 |         |              |
|         | 整 |          |                 |         |              |
|         | 块 |          |                 |         |              |
|         | 存 |          |                 |         |              |
|         | 储 |          |                 |         |              |
|         | 器 |          |                 |         |              |
|         | 内 |          |                 |         |              |
|         | 容 |          |                 |         |              |
|         | 拷 |          |                 |         |              |
|         | 贝 |          |                 |         |              |
|         | , |           |                 |         |              |
|         | > |           |                 |         |              |
|         |   |           |                 |         |              |
|         | 或 |          |                 |         |              |
|         | 将 |          |                 |         |              |
|         | 多 |          |                 |         |              |
|         | 个 |          |                 |         |              |
|         | 寄 |          |                 |         |              |
|         | 存 |          |                 |         |              |
|         | 器 |          |                 |         |              |
|         | 的 |          |                 |         |              |
|         | 内 |          |                 |         |              |
|         | 容 |          |                 |         |              |
|         | 拷 |          |                 |         |              |
|         | 贝 |          |                 |         |              |
|         | 到 |          |                 |         |              |
|         | 存 |          |                 |         |              |
|         | 储 |          |                 |         |              |
|         | 器 |          |                 |         |              |
|         | 中 |          |                 |         |              |
+---------+---+-----------+-----------------+---------+--------------+
| > 编    | > | 码        |                 | > 编    |              |
| 码长度  |   | 长度可变, |                 | 码长度  |              |
|         | 编 | 1\~15字节 |                | 固定，  |              |
|         |   |           |                 | 通常为  |              |
|         |   |           |                 | 4个字节 |              |
+---------+---+-----------+-----------------+---------+--------------+
| > 寻    | > | >         |                 | > 简    |              |
| 址方式  |   |  方式多样 |                 | 单寻址  |              |
|         | 寻 |          |                 |         |              |
+---------+---+-----------+-----------------+---------+--------------+
| > 操作  | > |           |                 | > 只能  |              |
|         |   |           |                 | 对寄存  |              |
|         | 可 |          |                 | 器执行  |              |
|         | 以 |          |                 | 算术和  |              |
|         | 对 |          |                 | 逻辑运  |              |
|         | 存 |          |                 | >       |              |
|         | 储 |          |                 | 算操作, |              |
|         | 器 |          |                 | > Load/ |              |
|         | 和 |          |                 | Store体 |              |
|         | 寄 |          |                 | 系结构  |              |
|         | 存 |          |                 |         |              |
|         | 器 |          |                 |         |              |
|         | 进 |          |                 |         |              |
|         | 行 |          |                 |         |              |
|         | 算 |          |                 |         |              |
|         | 术 |          |                 |         |              |
|         | 和 |          |                 |         |              |
|         | 逻 |          |                 |         |              |
|         | 辑 |          |                 |         |              |
|         | 运 |          |                 |         |              |
|         | 算 |          |                 |         |              |
+---------+---+-----------+-----------------+---------+--------------+
| > 编译  | > |           |                 | > 采    |              |
|         |   |           |                 | 用优化  |              |
|         | 难 |          |                 | 编译技  |              |
|         | 以 |          |                 | 术,生成 |              |
|         | 用 |          |                 | 高效的E |              |
|         | 优 |          |                 | > 标代  |              |
|         | 化 |          |                 | 码程序  |              |
|         | 编 |          |                 |         |              |
|         | 译 |          |                 |         |              |
|         | 器 |          |                 |         |              |
|         | 生 |          |                 |         |              |
|         | 成 |          |                 |         |              |
|         | 高 |          |                 |         |              |
|         | 效 |          |                 |         |              |
|         | 的 |          |                 |         |              |
|         | 目 |          |                 |         |              |
|         | 标 |          |                 |         |              |
|         | 代 |          |                 |         |              |
|         | 码 |          |                 |         |              |
|         | 程 |          |                 |         |              |
|         | 序 |          |                 |         |              |
+---------+---+-----------+-----------------+---------+--------------+
|         |   |           |                 |         |              |
+---------+---+-----------+-----------------+---------+--------------+

> 嵌入式系统原理与应用
>
> 4\. ARM的流水线结构
>
> (1)指令执行的阶段
>
> 计算机中的1条指令的执行可以分若干个阶段:
>
> 1)取指令,从存储器中取出指令(fetch)
>
> 2)译码,指令译码(decode);
>
> 3)取操作数,假定操作数从寄存器组中取(reg);
>
> 4)执行运算(ALU)
>
> 5)存储器访问,操作数与存储器有关(mem);
>
> 6)结果写回寄存器(res)。
>
> (2)流水线的分类
>
> 1)3级流水线ARM组织
>
> 取指令(fetch) :从寄存器装载一条指令。
>
> 译码(decode)
> :识别被执行的指令,并为下一个周期准备数据通路的控制信号。在这一级,
> 指令占有译码逻辑，不占用数据通路
>
> 执行(excute)
> :处理指令并将结果写回寄存器,图2.5为3级流水线的指令的执行过程。
>
> 取指令 译 得执行
>
> 图2.5 3级流水线
>
> 2\) 5级流水线ARM组织
>
> 取指令(fetch) :从存储器中取出指令,并将其放入指令流水线。
>
> 译码(decode)
> :指令被译码,从寄存器堆中读取寄存器操作数。在寄存器堆中有3个操作
> 数读端口,因此,大多数ARM指令能在1个周期内读取其操作数。
>
> 执行(execute)
> :将其中1个操作数移位,并在ALU中产生结果。如果指令是Load或Store
> 指令,则在ALU中计算存储器的地址
>
> 缓冲/数据(buffer/data)
> 如果需要则访问数据存储器,否则ALU只是简单地缓冲1个时钟周期。
>
> 回写(write-back)
> :将指令的结果回写到寄存器堆,包括任何从寄存器读出的数据,图2.6
> 为5级流水线的指令的执行过程
>
> 图2.6 5级流水线
>
> 3)6级流水线ARM组织。在ARM10中,将流水线的级数增加到6级(见图2.7),使系统
> 的平均处理能力达到了1.3DMIPS/MHz.
> CPU性能评估采用合成测试程序,较流行的有
> Whetstone和Dhrystone两种。Dhrystone主要用于测试整数计算能力,计算单位就是DMIPS.
> DMIPS可以理解为处理器单位时间内执行处理整数的指令的百万次数。而因为处理器的性能
> 与工作频率密切相关,在不同工作频率下测算出的DMIPS是不同的,所以通常使用
> DMIPS/MHz作为标准来评估各个处理器的结构优劣和性能高低。
>
> 取指令发时译执行在储日
>
> 图2.7 6级流水线
>
> 22
>
> 2.1.3 ARM体系结构的发展
>
> ARM公司开发了很多系列的ARM处理器核, 目前最新的系列是Cortex系列,而ARMe
> 核以及更早的系列已经很罕见了。目前应用比较广泛的系列是ARM7、ARM9、ARM9E、ARM10
> 及ARM11等,其中, ARM7,ARM9, ARM9E和ARM10为4个通用处理器系列, SecurCort
> 系列专门为安全要求较高的应用而设计,每一个系列提供一套相对独特的性能来满足不同应用
> 领域的需求。ARM处理器家族和体系架构对照表见表2-2.
>
> 表2-2 ARM处理器家族和体系架构对照表
>
> 体系结构及对应系列产品性能见表2-3.
>
> 表2-3 ARM系列产品性能对应表
>
> ARM7系 ARM7TDMI, ARM7TDMI-S ARM720T, ARMTEJ

3级流水

> 性能: 0.9MIPS/MHz, 可达到130MIPs (Dhrystone2.1)
>
> ARM926EJ-S, RM946E-S ARM9E系列\|ARM966E-S, ARM968E-S,
>
> ARM996HS
>
> 级流水,支持DSP指令。

性能: 1.1MIPS/MHz,可达300 MIPS (Dhrystone 2.1),高 性能AHB,软核(soft IP)

> ARM10系列ARM1020E, ARM1022R ARM1026EJ-S
>
> 6级流水支持分支预测(branch prediction),支持DSP指令

性能: 1.35MIPS/MHz,可选支持高性能浮点操作,双64
位总线接口，内部64位数据通路

> ARM1136/(E)-S ARM1156T2(F)-S,
>
> ARM1176JZ(F)-S

持分支预测和返回栈(Return Stack) 。强大的ARMv6指令 集,支持DSP, SIMD
(Single Instruction Multiple Data)扩\"
展,支持Thumb-2核心技术。低功耗0.6mw/MHz

> Cortex-A8,
>
> Cortex-M3
>
> Cortex-R4
>
> Cortex-A系列:面向用于复杂OS和应用的应用处理器 (applications
> processors) ,支持ARM和Thumb指令集
> Cortex-R系列:面向嵌入式实时领域的嵌入式处理器,支 持ARM和Thumb指令集

Cortex-M系列:面向深嵌入式价格敏感的嵌入式处理器, 只支持Thumb指令集

> SecurCore SC100, SecurCore SC200

用于Smart Card和Secure IC的32-bit解决方案。支持 ARM和Thumb指令集,软核。

> 且有空全特征和低成本它全存储保护单元
>
> ARM处理器选择及更多信息请查看网站:
> www.arm.com/products/processors/selector.php。
>
> 23

![](media/image15.jpeg)

ARM7系列处理器主要用于对功耗和成本要求比较苛刻的消费类产品。其最高主频可以
达到130MIPS. ARM7系列包括ARM7TDMI, ARMTDMI-S, ARM7EJ-S和ARM720T pu
种类型,主要用于适应不同的市场需求。

ARMTTDMI基于ARM体系结构V4版本,是目前低端的ARM核。它具有广泛的应用,
其最显著的应用为数字移动电话。

注意: \"ARM核"并不是芯片, ARM核与其它部件如RAM, ROM、片内外设组合在一
起才能构成现实的芯片。

> ARMTTDMI支持32位寻址范围,并弥补了ARM6不能在低于5V电源电压下工作的不
> 足。ARMTTDMI的后缀意义如下:

支持片上调试：

支持高密度16位的Thumb指令集;

ARMTDMI处理器使用流水线来增加处理器指令流的速度。这样可使几个操作同时进行,
并使处理和存储器系统连续操作,能提供0.9MIPS/MHz的指令执行速度。

> ARMTDMI的流水线分3级,分别为:取指一译码一执行。

ARMTDMI处理器使用了冯·诺依曼结构,指令和数据共用一条32位总线,只有装载。
存储和交换指令可以对存储器中的数据进行访问。

> 2\. ARM9处理器系列

ARM9系列处理器是高性能的处理器单元,主要品种有ARM920T和ARM922T.ARM9207
体系结构框如图2.8所示

> ![](media/image16.jpeg)
>
> 图2.8 ARM920T体系结构框图
>
> ARM9系列处理器的内核是ARMV4T体系,采用数据存储器和指令存储器分离的哈佛结

![](media/image17.jpeg)

> 第2章ARM处理器
>
> ARM9E系列微处理器的主要特点如下:
>
> 1)支持DSP指令集,适合于需要高速数字信号处理的场合;
>
> 2)5级整数流水线,指令执行效率更高;
>
> 3)支持32位ARM指令集和16位Thumb指令集;
>
> 4)支持32位的高速AMBA总线接口
>
> 5)支持VFP9浮点处理协处理器;
>
> 6)全性能的MMU,支持Windows CE. Linux, Palm Os等多种主流嵌入式操作系统;
>
> 7\) MPU支持实时操作系统;
>
> 8)支持数据Cache和指令Cache,具有更高的指令和数据处理能力;
>
> 9)主频最高可达300MIPS
>
> ARM9E系列处理器主要应用于下面这些场合:
>
> 1)下一代无线设备,包括视频电话和PDA等；
>
> 2)数字消费品,包括机顶盒、家庭网关、MP3播放器和MPEG-4播放器;
>
> 3)成像设备,包括打印机、数码照相机和数码摄像机
>
> 4)存储设备,包括DVD或HDD等
>
> 5)工业控制,包括电机控制等
>
> 6)汽车、通信和信息系统的ABS和车体控制;
>
> 7)网络设备,包括VoIP. WirelesSLAN等。
>
> 4\. ARM11处理器系列

ARM11系统处理器是针对高性能和高能效应而设计的。ARM1136J-S是第一个执行
ARMv6架构指令的处理器。它集成了一条具有独立的Load/Stroe和算术流水线的8级流水线。
ARMv6指令包含了针对媒体处理的单指令流多数据流扩展,并且采用特殊的设计来改善视频
处理能力

> ARM11系列处理器主要应用特点如下

1\)
ARMv6架构是根据下一代的消费类电子、无线设备、网络应用和汽车电子产品等的需
求而制定的。

2\)
ARM11处理器系列的媒体处理能力和低功耗特点特别适用于无线和消费类电子产品;
其高数据吞吐量和高性能的结合非常适合网络处理应用;在实时性能和浮点处理等方面
ARM11则可以满足汽车电子应用的需求。

> 5\. SecurCore处理器系列

SecurCore系列微处理器专为安全需要而设计,提供了完善的32位RISC技术的安全解决
方案。
SecurCore系列微处理器除了具有ARM体系结构的低功耗、高性能的特点外,还具有
其独特的优势,即提供了对安全解决方案的支持。

> SecurCore系列微处理器除了具有ARM体系结构各种主要特点外,还在系统安全方面具
> 有如下的特点：
>
> 1)支持ARM指令集和Thumb指令集,以提高代码密度和系统性能;
>
> 2)带有灵活的保护单元,以确保操作系统和应用数据的安全
>
> 27
>
> 嵌入式系统原理与应用
>
> 3)采用软内核技术,防止外部对其进行扫描探测;
>
> 4)可集成用户自己的安全特性和其他协处理器
>
> 5)提供面向智能卡和低成本的存储保护单元MPU.
>
> SecurCore系列微处理器主要应用于一些对安全性要求较高的应用产品及应用系统,如电
> 子商务、电子政务、电子银行业务、网络和认证系统等领域。
>
> SecurCore系列微处理器包含SecurCoreSC100、 SecurCoreSC110、
> SecurCoreSC200和 SecurCoreSC210四种类型,以适用于不同的应用场合。
>
> 因此, ARM结构体系版本(Architecture)如图2.10所示。
>
> ![](media/image18.jpeg)
>
> 2.2.2 ARM Cortex处理器
>
> 基于ARMv7架构的ARM处理器已经不再延用过去的数字命名方式,而是冠以Cortex的
> 称呼。基于V7A的称为\"Cortex-A系列",基于V7R的称为"Cortex-R系列",基于V7M的
> 称为"Cortex-M系列"。
> Cortex系列是ARM公司目前最新内核系列,属于v7架构,主要有 Cortex-A8.
> Cortex-R4, Cortex-M3. Cortex-M1等处理器。具体分类延续了一直以来ARM
> 面向具体应用设计CPU的思路。
>
> 1\. Cortex-M系列处理器
>
> ARM Cortex-M系列的CPU处理器内核(包括ARM Cortex-MO. ARM Cortex-MI, ARM
> Cortex-M3处理器)的ARM文档集。
>
> ARM
> Cortex-M系列是针对成本敏感的应用程序进行优化的深层嵌入式处理器。这些处理
> 器仅支持Thumb-2指令集。此系列包含Cortex-M4、 Cortex-M3、Cortex-MI
> FPGA和 Cortex-Mo处理器。
>
> Cortex-M系列针对成本和功耗敏感的MCU和终端应用(如智能测量、人机接口设备、汽
> 车和工业控制系统、大型家用电器、消费性产品和医疗器械)的混合信号设备进行过优化。
>
> Cortex-M3处理器是首款基于ARMV7-M架构的处理器,采用了纯Thumb2指令的执行方式,
> 具有极高的运算能力和中断响应能力。它主要应用于汽车车身系统、工业控制系统和无线网络等
> 对功耗和成本敏感的嵌入式应用领域。目前最便宜的基于该内核的ARM单片机售价为1美元。
>
> Cortex-M3处理器主要是面向低成本和高性能的MCU应用领域,相比ARMTTDMI, M
>
> 28

![](media/image19.jpeg)

![](media/image20.jpeg)

> و 2章 ARM处理器
>
> 2.2.3 ARM Cortex-M4处理器
>
> ARM Cortex-M4处理器是由ARM专门开发的最新嵌入式处理器,在M3的基础上强化
> 了运算能力,增加了浮点、DSP以及并行计算等。Cortex-M4处理器的最大亮点之一就是增加
> 了一个单精度浮点单元(FPU),能够高效率地处理较为复杂的浮点运算,如电机闭环控制、PID
> 算法、快速傅里叶变换等。Cortex-M4处理器应用在许多高性能的微控制器产品中,最大的时
> 钟频率可以达到400Mhz, Cortex-M4架构如图2.13所示
>
> ![IMAGE](media/image21.jpeg){width="3.5in"
> height="2.2083333333333335in"}
>
> 图2.13 ARM Cortex-M4处理器内核图
>
> Cortex-M4处理器在很多方面和Cortex-M3处理器相同,比如流水线和编程模型
> Cortex-M4处理器支持Cortex-M3处理器的所有功能,并额外支持各种面向数字信号处理
> (DSP)应用的指令,像SIMD,饱和运算指令,一系列单周期MAC指令(Cortex-M3处理器只
> 支持有限条MAC乘加指令,并且是多周期执行的)和可选的单精度浮点运算指令。Cortex-M
> 处理器的SIMD操作可以并行处理两个16位数据和4个8位数据
>
> 2.3 STM32系列微控制器
>
> ST公司的STM32系列是高性能的32位微控制器,工作频率高达168MHz,支持所有的
> ARM单精度数据处理指令和数据类型,具有DSP指令和自适应的实时加速器(ART)
> ,允许从 闪存中零等待状态实现存储器保护单元和210 DMIPS/1.25 DMIPS/MHz
> (Dhrystone 2.1) ,主要
> 用在电机驱动和应用控制、医疗设备、PLC、逆变器、电路断路器、打印机和扫描仪、告警系
> 统、HVAC和家庭音频设备等方面
>
> 2.3.1 STM32微控制器分类

STM32微控制器有八大系列产品, STM32F4系列具有DSP功能的高性能产品
(STM32F405/415/407/417), STM32F2系列的高性能产品(STM32F205/215/217),
STM32F1系 列互联型产品(STM32F105/107), STM32F1系列增强型产品(STM32F103),
STM32L1系列超
低功耗型产品(STM32F151/152),其中高性能MCU的STM32F2,STM32F4, STM32F7和
STM32H7系列,主流的MCU的STM32FO, STM32G0,STM32F1,STM32F3系列,超低功

> 31
>
> 嵌入式系统原理与应用
>
> E MCU的STM32LO、 STM32L1, STM32L4, STM32L4+和STM32L5系列,无线系列MCU
> 的STM32WB。其主要的产品型号如图2.14和图2.15所示
>
> 2
>
> 第2章 ARM处理器
>
> 示无线类型,其中F类型中FOxx系列和Flxx系列为2.0-3.6V;
> F2xx\~F4xx系列为1.8\~3.6V. 【407】-产品子系列405/407表示不加密模块,
> 415/417表示加密模块。
>
> 【z】- 芯片引脚数, Z表示144PIN,芯片引脚数与符号关系见表2-5.
>
> 表 2-5 芯片引脚数与符号对应表
>
> \(G\) 关系如表2-6所示。

+----------------------+-----------------------+-----------------------+
| > 数量               | > 4号                 | > 数量                |
+----------------------+-----------------------+-----------------------+
| > 20PIN              |                       | > 64PIN 委            |
+----------------------+-----------------------+-----------------------+
| > 28PIN              |                       | > 90PIN               |
+----------------------+-----------------------+-----------------------+
| > 32PIN              |                       | > 100PN               |
+----------------------+-----------------------+-----------------------+
| > 36PIN              |                       | > 132PIN              |
+----------------------+-----------------------+-----------------------+
| > 40PIN              |                       | > 176PIN 44PD         |
+----------------------+-----------------------+-----------------------+
| > 48PIN              |                       |                       |
+----------------------+-----------------------+-----------------------+
| > 63PIN              |                       |                       |
+----------------------+-----------------------+-----------------------+

> Flash存储容量, G表示1MB Flash存储容量, Flash存储器的存储容量与符号
>
> 表2-6 Flash存储器与符是突 对应
>
> 16KB\| 32KB64KR 128KR256KB 384KB512KB\|768KR1MR
>
> 【T】-芯片封装形式,T表示LOFP封装, H表示BGA封装, U表示VFOFPN封装,
> Y表示WLCSP/WLCSP64封装。
>
> 【6】-温度范围, 6表示工业级温度范围为-40℃\~850℃, 7表示工业级温度范围为
> -40°C\~1055°C.
>
> 2.3.2 STM32系列处理器的优点
>
> STM32是基于ARM Cortex M处理器内核的32位闪存微控制器,为MCU用户开辟了一
> 个全新的自由开发空间,并提供了各种易于上手的软硬件辅助工具。
>
> STM32与51单片机、ARM、嵌入式系统之间有如下关系
>
> 1\. STM32与51单片机
>
> 生成厂家: STM32是意大利知名公司意法半导体生产的32位处理器,在ARM
> Cortex-M
> 内核上做了一系列的优化,包括存储器、引脚数量以及各种外设的优化与整改;
> 51单片机是 Inter在1981年推出了8位8051微控制器,
> Intel将8051的内核授权给其它芯片厂商,如ATMEL. 台湾的宏晶。
>
> 硬件资源: STM32与单片机的用途相同,都是微处理器MCU,但STM32是32位单片机,
> 而51单片机是8位; STM32的内部RAM和ROM(flash)都比51单片机大很多; STM32的
> 主频也很高,分别达72M和168M,因此运算能力要强大的多, 51单片机主频12MHz;
> STM32 片上外设也比较丰富,定时器多达14个或17个,
> PWM功能强大,其ADC精度也达到12位,
> 还有DA模块、实时时钟,较高档次的还有浮点运算单元、DSP功能、DMA控制器、USB控
> 制器、高档有的还有摄像头接口和网络接口等,而51单片机只有2个定时器,一个10位ADC
> 和DAC转换器,外设资源很少
>
> 软件开发:
> STM32单片机程序都是模块化的,接口相对简单,因为它自身有好多功能。
>
> 33
>
> 嵌入式系统原理与应用
>
> 工作速度也快,所以它不仅可以使用寄存器进行编程,还可以使用官方提供的库文件进行编程,
> 编程方便,更容易移植,而51的自身功能少,需要外围元件多,开发编程比较复杂
>
> 2\. STM32与ARM
>
> ARM是英国的芯片设计公司,其最成功的就是32位嵌入式CPU核-ARM系列。最
> 常用的是ARM7和ARM9, ARM处理器传统的命名是ARM+数字的方式如ARM7, ARM9.
> ARM11,在ARM11以后, ARM公司使用了新的命名方式: Cortex,
> ARM公司只负责提供内 核部分,
> ARM把这个核卖给各大半导体公司,如Pllips、三星、ATMEL, Intel等。其中STM3
> 就是意法半导体公司以Cortex-Mx为内核的单片机,关系如图2.16所示。
>
> ![IMAGE](media/image22.jpeg){width="6.652777777777778in"
> height="2.4305555555555554in"}
>
> 图2.16 STM32与ARM关系图
>
> 3\. STM32与嵌入式
>
> 嵌入式一般指包括处理器、外部设备和程序组合起来能实现一定功能的专用系统,它的处
> 理器又包括ARM处理器、DSP处理器、FPGA及微控制器MCU等,嵌入式范围更大,属于
> 系统级。STM32只是一系列微控制器MCU芯片,只是芯片级,也属于嵌入式。
>
> 总之,嵌入式是一个专用系统,包括处理器、外设和程序。STM32由意法半导体制造
> 采用ARM Cortex-M内核的一系列单片机。

2.3.3 STM32处理器开发工具

> STM32处理器具有广泛的第三方支持的开发语言、开发软件、调试工具和操作系统。
> 1,支持的开发软件
>
> 支持的开发软件主要有REALVIEW MDK. IAR EWARM和Keil MDK,其中Keil MDK
> 使用的最广泛。Keil是德国知名软件公司Kei(现已并入ARM公司)开发的微控制器软件开发
> 平台,是目前ARM内核单片机开发的主流工具。Keil提供了包括C编译器、宏汇编、连接器
> 库管理和一个功能强大的仿真调试器在内的完整开发方案,通过一个集成开发环境(Vision
> 将这些功能组合在一起。uVision当前的最高版本是uVision4,它的界面和常用的微软VC++.
>
> 34

![](media/image23.jpeg)

![](media/image24.jpeg)

> 第2章 ARM处理器
>
> 本章小结

本章主要介绍了ARM处理器的一些关键技术,如ARM核的体系结构特征、工作模式、
存储系统、流水线、寄存器组织等。本章还介绍了ARM Cortex核的处理器、ARM
CortexMa
处理器以及STM32系列微控制器的分类、特点及其常用开发工具等。通过本章的学习,对
ARM核的一些关键技术有所认识,对STM32系列除控制器的特征及开发工具也有了一定的
了解，为后续章节的学习奠定了基础

> 习题
>
> 1\. ARM处理器体系结构有哪些,各自的特点是什么?
>
> 2.采用v7架构ARM Cortex内核系列主要包括哪些处理器，各类的特点是什么?
>
> 3,简述STM32处理器的命名规则,比如STM32F407ZGT6处理器。
>
> 4,简述STM32与51单片机、ARM、嵌入式系统之间的关系。
>
> 37
>
> 通过前面ARM处理器及其STM32系列微控制器的介绍,对其分类和特征等有一定的了
> 解。本章主要从STM32F407单片机的组成、存储器、总线及构成最小系统等方面进行深入分
> 析。通过本章学习需要初步掌握STM32F407单片机内部结构,熟悉STM32F407单片机的总
> 线结构、存储器系统及其映射关系,为后续指令系统及其编程奠定基础。
>
> 3.1 STM32F407单片机的内部结构
>
> 3.1.1 STM32F407的组成 1.内核
>
> \(1\) 32位高性能ARM Cortex-M4处理器;
>
> (2)时钟:高达168MHz
>
> (3)支持FPU(浮点运算)和DSP指令。 2. 1/0口
>
> \(1\) STM32F407ZGT6: 144引脚114个10口
>
> (2)大部分I/O口都耐5V(模拟通道除外);
>
> (3)支持调试: SWD和JTAG, SWD只要2根数据线。
>
> 3.存储器
>
> 存储器容量: 1024K FLASH, 192K SRAM.
>
> 4,时钟、复位和电源管理
>
> \(1\) 1.8-3.6V电源和1/0电压;
>
> (2)上电复位、掉电复位和可编程的电压监控;
>
> (3)强大的时钟系统
>
> 1)4-26M的外部高速晶振;
>
> 2)内部16MHz的高速RC振荡器;
>
> 3)内部锁相环(PLL,倍频),一般系统时钟都是外部或者是内部高速时钟经过PLL倍奶
> 后得到的：
>
> 4)外部低速32.768K的晶振,主要做RTC时钟源
>
> 5.低功耗
>
> (1)睡眠、停止和待机三种低功耗模式;
>
> (2)可用电池为RTC和备份寄存器供电
>
> 第3章 STM32F407单片机
>
> 6\. A/D转换器
>
> (1)3个12位AD(多达24个外部测试通道;
>
> (2)内部通道可以用于内部温度测量;
>
> (3)内置参考电压。
>
> 7\. D/A转换器
>
> 2个12位D/A.
>
> 8\. DMA控制器
>
> \(1\) 16个DMA通道,带FIFO和突发支持;
>
> (2)支持外设:定时器、ADC. DAC. SDIO. 12S、 SPI. I2C和USART.
>
> 9\. 17个定时器
>
> \(1\) 10个通用定时器(TIM2和TIM5是32位)
>
> \(2\) 2个基本定时器
>
> \(3\) 2个高级定时器：
>
> (4)1个系统定时器
>
> \(5\) 2个看门狗定时器
>
> 10\. 17个通信接口
>
> \(1\) 3个12C接口;
>
> \(2\) 6个串口;
>
> \(3\) 3个SPI接口;
>
> \(4\) 2个 CAN2.0
>
> \(5\) 2 USB OTG;
>
> \(6\) 1TSDIO.
>
> 3.1.2 STM32F407芯片相关参数 1、芯片对应的参数表(见表3-1)
>
> 表3-1 STM32F407参数表

<table style="width:100%;">
<colgroup>
<col style="width: 5%" />
<col style="width: 2%" />
<col style="width: 4%" />
<col style="width: 4%" />
<col style="width: 2%" />
<col style="width: 4%" />
<col style="width: 5%" />
<col style="width: 0%" />
<col style="width: 4%" />
<col style="width: 1%" />
<col style="width: 9%" />
<col style="width: 3%" />
<col style="width: 1%" />
<col style="width: 2%" />
<col style="width: 1%" />
<col style="width: 1%" />
<col style="width: 2%" />
<col style="width: 4%" />
<col style="width: 2%" />
<col style="width: 1%" />
<col style="width: 2%" />
<col style="width: 2%" />
<col style="width: 0%" />
<col style="width: 4%" />
<col style="width: 5%" />
<col style="width: 4%" />
<col style="width: 3%" />
<col style="width: 3%" />
<col style="width: 0%" />
<col style="width: 2%" />
<col style="width: 0%" />
<col style="width: 1%" />
</colgroup>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Serial</p>
</blockquote></td>
<td><blockquote>
<p>inter</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2"><blockquote>
<p>|Supply cur</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>Timer funetions</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Ma</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><blockquote>
<p>Part</p>
</blockquote></td>
<td>aum</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>A</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>L USAT</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>ot</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><blockquote>
<p>ay</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>lEthem</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>as ath</p>
</blockquote></td>
<td rowspan="2"><blockquote>
<p>yt interma</p>
</blockquote></td>
<td rowspan="2"><blockquote>
<p>RA</p>
</blockquote></td>
<td rowspan="2"><blockquote>
<p>Packi</p>
</blockquote></td>
<td><blockquote>
<p>ก</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>ADC DAC</p>
</blockquote></td>
<td rowspan="2"><blockquote>
<p>VOs</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>|SP Su IS PC UA</p>
</blockquote></td>
<td></td>
<td><blockquote>
<p>US</p>
</blockquote></td>
<td></td>
<td>C</td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>|</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>-</p>
</blockquote></td>
<td></td>
<td>Oter</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>100</p>
</blockquote></td>
<td></td>
<td rowspan="2"><blockquote>
<p>(A</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><blockquote>
<p>TM32</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>4</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Yes</p>
</blockquote></td>
<td></td>
<td></td>
<td>18 056 25 238</td>
<td colspan="2"><blockquote>
<p>-40 <sup>t</sup></p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><blockquote>
<p>TM321</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>42 1</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Yes</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>0 t</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td>1</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><blockquote>
<p>STEA</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>ΩP</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>42</p>
</blockquote></td>
<td><blockquote>
<p>2</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Yres</p>
</blockquote></td>
<td><blockquote>
<p>1</p>
</blockquote></td>
<td></td>
<td></td>
<td colspan="3"><blockquote>
<p>40 t0 +</p>
</blockquote></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>42</p>
</blockquote></td>
<td><blockquote>
<p>2</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>Yes</p>
</blockquote></td>
<td rowspan="2"><blockquote>
<p>7י t</p>
</blockquote></td>
<td></td>
<td></td>
<td colspan="3" rowspan="2">| -40 0 4</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><blockquote>
<p>STM2-4</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>FBCAT</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><blockquote>
<p>STM3FAIT</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>FE</td>
<td></td>
<td></td>
<td>wDG</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>4</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Yos</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td>|00</td>
<td></td>
<td></td>
<td></td>
<td>1</td>
</tr>
<tr class="odd">
<td><blockquote>
<p>me2</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>OR</p>
</blockquote></td>
<td></td>
<td></td>
<td colspan="2"><blockquote>
<p>wn count</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>42</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Yes</p>
</blockquote></td>
<td><blockquote>
<p>113</p>
</blockquote></td>
<td></td>
<td></td>
<td colspan="3"><blockquote>
<p>|-10 0 +1</p>
</blockquote></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><blockquote>
<p>STM241</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>QFP100</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>42</p>
</blockquote></td>
<td><blockquote>
<p>3</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Yes</p>
</blockquote></td>
<td><blockquote>
<p>t</p>
</blockquote></td>
<td></td>
<td></td>
<td colspan="3">| -40 0 +1</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><blockquote>
<p>STM2E40</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>QFP144</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>4</p>
</blockquote></td>
<td><blockquote>
<p>2</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Yes</p>
</blockquote></td>
<td><blockquote>
<p>3טית</p>
</blockquote></td>
<td></td>
<td></td>
<td colspan="3">| -0 0 4</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>4</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>|</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><blockquote>
<p>TM32</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>op</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>39</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

> 嵌入式系统原理与应用
>
> ,芯片及封装图(见图3.1和图3.2)
>
> ভ ARMPE
>
> 图3.1 STM32F407芯片图 3.芯片内部结构图
>
> STM32F4x内部结构如图3.3所示

图3.2 STM32F407封装图

<table style="width:100%;">
<colgroup>
<col style="width: 8%" />
<col style="width: 1%" />
<col style="width: 0%" />
<col style="width: 1%" />
<col style="width: 5%" />
<col style="width: 0%" />
<col style="width: 1%" />
<col style="width: 0%" />
<col style="width: 2%" />
<col style="width: 1%" />
<col style="width: 4%" />
<col style="width: 2%" />
<col style="width: 0%" />
<col style="width: 3%" />
<col style="width: 1%" />
<col style="width: 2%" />
<col style="width: 2%" />
<col style="width: 2%" />
<col style="width: 4%" />
<col style="width: 1%" />
<col style="width: 1%" />
<col style="width: 1%" />
<col style="width: 2%" />
<col style="width: 1%" />
<col style="width: 0%" />
<col style="width: 3%" />
<col style="width: 1%" />
<col style="width: 1%" />
<col style="width: 1%" />
<col style="width: 1%" />
<col style="width: 3%" />
<col style="width: 1%" />
<col style="width: 3%" />
<col style="width: 3%" />
<col style="width: 1%" />
<col style="width: 2%" />
<col style="width: 2%" />
<col style="width: 5%" />
<col style="width: 1%" />
<col style="width: 0%" />
<col style="width: 6%" />
</colgroup>
<tbody>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td>E</td>
<td></td>
<td></td>
<td colspan="8">LCM daeR AM G KE</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="5"><blockquote>
<p>Examal mem</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>,IEM</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3"><blockquote>
<p>TAG &amp;SW</p>
</blockquote></td>
<td colspan="2"><blockquote>
<p>MPU</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="9"><blockquote>
<p>SRAM, PSRA, NOR Fl</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>HΗρ</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td colspan="2" rowspan="2"><blockquote>
<p>TAR epg</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>C Cart</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td>AN,</td>
<td></td>
<td></td>
<td>A</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>|</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="6"><blockquote>
<p>IETM NVC ARM CoterM4 M 11M</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>E</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td>Flash</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3" rowspan="2"><blockquote>
<p>henet MAC</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>1MB</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>L</p>
</blockquote></td>
<td></td>
<td colspan="2"><blockquote>
<p>Camer</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2" rowspan="2"><blockquote>
<p>ihnerhe</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>S</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><blockquote>
<p>.</p>
</blockquote></td>
<td></td>
<td></td>
<td>τ</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3" rowspan="2"><blockquote>
<p>OTeHS |</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>ตั</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>USE</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2" rowspan="2"><blockquote>
<p>DMA</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2">OTG F</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>|</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2"><blockquote>
<p>ന০<sup>-</sup></p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>|</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>5</p>
</blockquote></td>
<td></td>
<td colspan="5" rowspan="2"><blockquote>
<p>GPIO PORT</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2"><blockquote>
<p>هام</p>
</blockquote></td>
<td></td>
<td>BR</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3"><blockquote>
<p>GPIO PORT</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>শ</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td colspan="6"><blockquote>
<p>LGPIO PORTC T</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>L</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="4"><blockquote>
<p>GPIO PORT D</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3" rowspan="2"><blockquote>
<p>GPIO PORT</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>WDO</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>P</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td colspan="4"><blockquote>
<p>PIO PORTF о</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>1</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>1</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>T</p>
</blockquote></td>
<td colspan="3">GPIO PORT G</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>প</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>T</td>
<td></td>
<td></td>
<td colspan="3"><blockquote>
<p>GPI PORT H</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>|</p>
</blockquote></td>
<td></td>
<td><blockquote>
<p>น</p>
</blockquote></td>
<td>2</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="6"><blockquote>
<p>GPIO PORTI</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>|</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3"><blockquote>
<p>KE EKRSA</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>K4and,</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td>TR</td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>TNS</td>
<td></td>
<td></td>
<td><blockquote>
<p>K,</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td colspan="4"><blockquote>
<p>EXT IT. WKUP</p>
</blockquote></td>
<td></td>
<td></td>
<td>B</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>A</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>TIM</td>
<td></td>
<td></td>
<td><blockquote>
<p>Ka,</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>T</td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>TINS</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3" rowspan="2"><blockquote>
<p>SDIO/MC</p>
</blockquote></td>
<td></td>
<td>E</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="5" rowspan="2">|HAEΣ JA</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Kd</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td><blockquote>
<p>*</p>
</blockquote></td>
<td>ப</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>T</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>BAPB</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>A</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>T</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td><blockquote>
<p>ப</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="5">TIMB /PM</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><blockquote>
<p>2</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2">ப</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>TIMפ</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>પ</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td>1</td>
<td></td>
<td></td>
<td></td>
<td rowspan="2">ப</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>T</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>WWIDG</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="4"><blockquote>
<p>UARTS</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>T</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>USA</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>TM</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td rowspan="2">SPZIZS2 SP2</td>
<td></td>
<td></td>
<td><blockquote>
<p>M</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>প</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td>క</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>SPI</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3"><blockquote>
<p>TIMT</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>م</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3">C1/SMBUS T</td>
<td colspan="2"><blockquote>
<p>α,</p>
</blockquote></td>
<td><blockquote>
<p>0</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="4"><blockquote>
<p>Tmprur sena</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3">12C2SMBUS</td>
<td></td>
<td><blockquote>
<p>,</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="2">C3ISMBUS</td>
<td></td>
<td><blockquote>
<p>Κα</p>
</blockquote></td>
<td></td>
<td><blockquote>
<p>0</p>
</blockquote></td>
<td>ΒΑ</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td></td>
<td><blockquote>
<p>κ</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td colspan="3"><blockquote>
<p>ADCi</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>-</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>TR</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>

> 1,连接到APB2的定时器由TIMxCLK提供高达168MHz的时钟,而连接到APB1的定时器由TIMXCLR
> 提供高达84 MHz或268MHz的时钟,具体取决RCC- DCKCFGE
> register寄存器中的TIMPRE位配置
>
> 2.摄像机接口和以太网仅适用于STM23F407xx设备。
>
> 图3.3 STM32F4x内部结构图
>
> 40
>
> 第3章 STM32F407单片机
>
> 4,参考资料
>
> (1)STM32F4数据手册:STM32F407ZGT6.pdf
>
> \(2\) STM32F4中文手册: STM32F4xx中文参考手册.pdf:
>
> (3)开发板原理图: Explorer STM32F4 Vxx SCH.pdf
>
> 3.2 STM32F407寄存器

STM32F407采用一个32位Cortex-M4处理器内核,该处理器内核主要包括的32位寄
存器组有13个通用寄存器(RO-R12);堆栈指针SP(R13),别名为\"banked\"寄存器,包把
主堆栈指针寄存器SP
main和进程堆栈指针寄存器SPprocess;连接寄存器LR(R14);程
字计数寄存器PC(R15);特殊功能程序状态寄存器XPSR.
Cortex-M4处理器的寄存器组如 R

> 图3.4所示。 RI

+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > R2        |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
| >           |   | > R3        |   |                    |                 |
|  低组寄存器 |   |             |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > RA        |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > R5        |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > R6        |   | > 通用寄存器       |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > R7        |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > R8        |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > R9        |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
| >           |   |             |   |                    |                 |
|  高组寄存器 |   |             |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > R1O       |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > R11       |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > R12       |   | >                  | 主堆栈指针(PSP  |
|             |   |             |   |  进程堆栈指针(PSP) |                 |
+-------------+---+-------------+---+--------------------+-----------------+
| >           |   | > SP(R13)   |   | > \|进             |                 |
|  堆栈寄存器 |   |             |   | 程维栈指指针(PSP)  |                 |
|             |   |             |   | > \|               |                 |
|             |   |             |   | >                  |                 |
|             |   |             |   |  \|主堆栈指针(MSP) |                 |
+-------------+---+-------------+---+--------------------+-----------------+
| >           |   | > L.R(R1    |   |                    |                 |
|  链接寄存器 |   |             |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
| >           |   | > PC(15     |   |                    |                 |
|  程序计数器 |   |             |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > PSR -     |   | > 程序状态寄存器   |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > PRIMS SP  |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   |             |   | > 中断屏蔽寄存器组 | >               |
|             |   |             |   |                    |  寺殊功能寄存器 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > FAULTMASK |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > BASEPRT   |   |                    |                 |
+-------------+---+-------------+---+--------------------+-----------------+
|             |   | > CONTROL   |   | > 控制寄存器       |                 |
+-------------+---+-------------+---+--------------------+-----------------+

> 图3.4 Cortex-M4处理器的寄存器组
> 这些寄存器都具有不同的作用范围和功能,下面分别介绍。
>
> \(1\)
> RO-R12是最具"通用目的"的32位通用寄存器,用于数据操作。大部分能够访问通
> 用寄存器的指令都可以访问RO-R12,其中,低组寄存器(RO-R7)-能够被所有访问通用
> 寄存器的指令访问;高组寄存器(R8-R12)-能够被32位通用寄存器指令访问,而不能被
> 所有16位指令访问
>
> 41
>
> (2)寄存器R13-R15具有以下特殊功能。
>
> 1)堆栈指针\--寄存器R13被用作堆栈指针SP。堆栈指针用于访问堆栈,因为SP忽略
> 写入到\[1:01位(即最低两位永远为0) ,所以堆栈是按照字对齐(4个字节对齐)
> 。
>
> 2)主堆栈指针(MSP)或者写作SP
> main,是复位后缺省使用的堆栈指针,它由操作系统
> (OS)、中断服务程序以及所有需要特权访问的应用程序代码来使用。比如\"Handler\"模式总
> 是使用SP main住堆栈指针,但也可以配置成\"Thread"模式来使用SP
> main主堆栈指针或 者SP process 进程堆栈指针。
>
> 3)进程堆栈指针(PSP)或者写作sp
> process,用于常规的应用程序代码,该堆栈一般供用 户的应用程序代码使用。
>
> 注意:并不是每一个应用程序都用到这两个堆栈指针,简单的应用程序只用到主堆栈指针
> 就够了, PUSH和POP指令默认使用SP寄存器
>
> 4)链接寄存器\-\--寄存器R14为子程序连接寄存器LR。在一个BL或者BLX指令被技
> 行后, LR从PC寄存器中获取返回地址,
> LR也被用于异常返回,在其他情况下也可以当做一 个通用寄存使用,
>
> 5)程序计数寄存器-寄存器R15是程序计数寄存器PC.寄存器指向当前的程序地址,
> 如果修改它的值,就能改变程序的执行流程。该寄存器的\[0\]位永远为0,则指令总是按照字对
> 齐或者半字对齐
>
> (3)特殊功能寄存器(SPR) 。 ARM
> Cortex-M4在内核上搭载了一些特殊功能寄存器,包
> 括程序状态寄存器组(PSR或者XPSR) 、中断屏蔽寄存器组(PRIMASK.
> FAULTMASK以及
> BASEPRI)和控制寄存器(Control),它们只能由专用的MSR和MRS指令访问,并且它们没有
> 存储器地址。
>
> 程序状态寄存器,在内部又将被分为三个子寄存器:应用程序程序状态寄存器APSR、中
> 断号程序状态寄存器IPSR和执行程序状态寄存器EPSR。通过MRS和MSR指令来单独或者
> 组合访问,当使用三合一的方式访问时,应使用名字xPSR或者PSR。三个寄存器位分配图如
> 图3.5所示,三合一的位分配图如3.6图所示
>
> 35 APSR.IPSR和EPSR的位公配厚 图3.

<table>
<colgroup>
<col style="width: 5%" />
<col style="width: 13%" />
<col style="width: 10%" />
<col style="width: 4%" />
<col style="width: 14%" />
<col style="width: 10%" />
<col style="width: 8%" />
<col style="width: 2%" />
<col style="width: 11%" />
<col style="width: 18%" />
</colgroup>
<tbody>
<tr class="odd">
<td><blockquote>
<p>31</p>
</blockquote></td>
<td>30 29 28127</td>
<td>26 25 24</td>
<td>23</td>
<td></td>
<td><blockquote>
<p>16 15</p>
</blockquote></td>
<td></td>
<td><blockquote>
<p>1</p>
</blockquote></td>
<td><blockquote>
<p>10 9</p>
</blockquote></td>
<td></td>
</tr>
<tr class="even">
<td><blockquote>
<p>|2</p>
</blockquote></td>
<td></td>
<td></td>
<td></td>
<td><blockquote>
<p>Reserved</p>
</blockquote></td>
<td></td>
<td>IC/IT</td>
<td></td>
<td></td>
<td>ISR NUMBER</td>
</tr>
</tbody>
</table>

> Reserved 图3.6 PSR的位分配图
>
> 1)应用程序程序状态寄存器APSR每一位的含义见表3-2.
>
> 第3章 STM32F407单片机

+-----------+-------+----+---+----+------------+----------------------+
|           |       |    | > | >  |            |                      |
|           |       |    |   | AP |            |                      |
|           |       |    | 表 | SR |           |                      |
|           |       |    | 3 | 寄 |            |                      |
|           |       |    | - | 存 |            |                      |
|           |       |    | 2 | 器 |            |                      |
|           |       |    |   | 位 |            |                      |
|           |       |    |   | 定 |            |                      |
|           |       |    |   | 义 |            |                      |
+-----------+-------+----+---+----+------------+----------------------+
|           |       |    |   |    |            | > 功能               |
+-----------+-------+----+---+----+------------+----------------------+
| > 位 31   | >     |    |   | >  |            |                      |
|           |  名称 |    |   | 负 |            |                      |
|           |       |    |   | 数 |            |                      |
|           |       |    |   | 标 |            |                      |
|           |       |    |   | 志 |            |                      |
|           |       |    |   | (  |            |                      |
|           |       |    |   | Ne |            |                      |
|           |       |    |   | ga |            |                      |
|           |       |    |   | ti |            |                      |
|           |       |    |   | ve |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   |  f |            |                      |
|           |       |    |   | la |            |                      |
|           |       |    |   | g) |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 1: |            |                      |
|           |       |    |   | 结 |            |                      |
|           |       |    |   | 果 |            |                      |
|           |       |    |   | 为 |            |                      |
|           |       |    |   | 负 |            |                      |
|           |       |    |   | 数 |            |                      |
|           |       |    |   | 或 |            |                      |
|           |       |    |   | 小 |            |                      |
|           |       |    |   | 于 |            |                      |
+-----------+-------+----+---+----+------------+----------------------+
| > 30      |       |    |   | >  |            |                      |
|           |       |    |   | 0: |            |                      |
|           |       |    |   | 结 |            |                      |
|           |       |    |   | 果 |            |                      |
|           |       |    |   | 为 |            |                      |
|           |       |    |   | 正 |            |                      |
|           |       |    |   | 数 |            |                      |
|           |       |    |   | 或 |            |                      |
|           |       |    |   | 大 |            |                      |
|           |       |    |   | 于 |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 零 |            |                      |
|           |       |    |   | 标 |            |                      |
|           |       |    |   | 志 |            |                      |
|           |       |    |   | (  |            |                      |
|           |       |    |   | Ze |            |                      |
|           |       |    |   | ro |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   |  f |            |                      |
|           |       |    |   | la |            |                      |
|           |       |    |   | g) |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 1: |            |                      |
|           |       |    |   | 结 |            |                      |
|           |       |    |   | 果 |            |                      |
|           |       |    |   | 为 |            |                      |
|           |       |    |   | 0  |            |                      |
+-----------+-------+----+---+----+------------+----------------------+
| > 29\]    |       | C  |   | >  |            |                      |
|           |       |    |   | 0: |            |                      |
|           |       |    |   | 结 |            |                      |
|           |       |    |   | 果 |            |                      |
|           |       |    |   | 为 |            |                      |
|           |       |    |   | 非 |            |                      |
|           |       |    |   | 0  |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 进 |            |                      |
|           |       |    |   | 位 |            |                      |
|           |       |    |   | /  |            |                      |
|           |       |    |   | 借 |            |                      |
|           |       |    |   | 位 |            |                      |
|           |       |    |   | 标 |            |                      |
|           |       |    |   | 志 |            |                      |
|           |       |    |   | (c |            |                      |
|           |       |    |   | ar |            |                      |
|           |       |    |   | ry |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | or |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | bo |            |                      |
|           |       |    |   | rr |            |                      |
|           |       |    |   | ow |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   |  f |            |                      |
|           |       |    |   | la |            |                      |
|           |       |    |   | g) |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 1: |            |                      |
|           |       |    |   | 进 |            |                      |
|           |       |    |   | 位 |            |                      |
|           |       |    |   | 或 |            |                      |
|           |       |    |   | 借 |            |                      |
|           |       |    |   | 位 |            |                      |
+-----------+-------+----+---+----+------------+----------------------+
| > \[281   |       | v  |   | >  |            |                      |
|           |       |    |   | 0: |            |                      |
|           |       |    |   | 没 |            |                      |
|           |       |    |   | 有 |            |                      |
|           |       |    |   | 进 |            |                      |
|           |       |    |   | 位 |            |                      |
|           |       |    |   | 或 |            |                      |
|           |       |    |   | 借 |            |                      |
|           |       |    |   | 位 |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 溢 |            |                      |
|           |       |    |   | 出 |            |                      |
|           |       |    |   | 标 |            |                      |
|           |       |    |   | 志 |            |                      |
|           |       |    |   | (  |            |                      |
|           |       |    |   | Ov |            |                      |
|           |       |    |   | er |            |                      |
|           |       |    |   | fl |            |                      |
|           |       |    |   | ow |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   |  f |            |                      |
|           |       |    |   | la |            |                      |
|           |       |    |   | g) |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 1: |            |                      |
|           |       |    |   | 溢 |            |                      |
|           |       |    |   | 出 |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 0: |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 没 |            |                      |
|           |       |    |   | 有 |            |                      |
|           |       |    |   | 溢 |            |                      |
|           |       |    |   | 出 |            |                      |
+-----------+-------+----+---+----+------------+----------------------+
| > 27      |       | Q  |   | >  |            |                      |
|           |       |    |   |  D |            |                      |
|           |       |    |   | SP |            |                      |
|           |       |    |   | 溢 |            |                      |
|           |       |    |   | 出 |            |                      |
|           |       |    |   | 或 |            |                      |
|           |       |    |   | 饱 |            |                      |
|           |       |    |   | 和 |            |                      |
|           |       |    |   | 标 |            |                      |
|           |       |    |   | 志 |            |                      |
|           |       |    |   | (D |            |                      |
|           |       |    |   | SP |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | ov |            |                      |
|           |       |    |   | er |            |                      |
|           |       |    |   | fl |            |                      |
|           |       |    |   | ow |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   |  a |            |                      |
|           |       |    |   | nd |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | sa |            |                      |
|           |       |    |   | tu |            |                      |
|           |       |    |   | ra |            |                      |
|           |       |    |   | ti |            |                      |
|           |       |    |   | on |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   |  f |            |                      |
|           |       |    |   | la |            |                      |
|           |       |    |   | g) |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 1: |            |                      |
|           |       |    |   | 溢 |            |                      |
|           |       |    |   | 出 |            |                      |
|           |       |    |   | 或 |            |                      |
|           |       |    |   | 饱 |            |                      |
|           |       |    |   | 和 |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | 0: |            |                      |
|           |       |    |   | 没 |            |                      |
|           |       |    |   | 有 |            |                      |
|           |       |    |   | 溢 |            |                      |
|           |       |    |   | 出 |            |                      |
|           |       |    |   | 或 |            |                      |
|           |       |    |   | 饱 |            |                      |
|           |       |    |   | 和 |            |                      |
+-----------+-------+----+---+----+------------+----------------------+
| >         |       |    |   | >  |            |                      |
|  \[26:20) |       |    |   | 保 |            |                      |
|           |       |    |   | 留 |            |                      |
|           |       |    |   | (  |            |                      |
|           |       |    |   | Re |            |                      |
|           |       |    |   | se |            |                      |
|           |       |    |   | rv |            |                      |
|           |       |    |   | ed |            |                      |
+-----------+-------+----+---+----+------------+----------------------+
| > \[19:16 | > GE\ |    |   | >  |            |                      |
|           | [3:01 |    |   |  G |            |                      |
|           |       |    |   | re |            |                      |
|           |       |    |   | at |            |                      |
|           |       |    |   | er |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | th |            |                      |
|           |       |    |   | an |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   | or |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   |  E |            |                      |
|           |       |    |   | qu |            |                      |
|           |       |    |   | al |            |                      |
|           |       |    |   | >  |            |                      |
|           |       |    |   |  f |            |                      |
|           |       |    |   | la |            |                      |
|           |       |    |   | gs |            |                      |
+-----------+-------+----+---+----+------------+----------------------+
| > 115:0   |       |    |   | >  | (Reserved) |                      |
|           |       |    |   | 留 |            |                      |
+-----------+-------+----+---+----+------------+----------------------+

> 2)中断程序程序状态寄存器IPSR为当前被响应的异常的ISR编号。其含义见表3-3。
> 表3-3 IPSR寄存器位定义
>
> 15-IRO(n-1)a
>
> 3)执行程序程序状态寄存器EPSR,当执行LDM、 STM和If-then多周期指令时,如果
> 在执行过程中发生异常,处理器会暂时停止以上指令的操作,进入异常,这时需要用EPSR资
> 存器保护现场。EPSR含义见表3-4。
>
> 43
>
> 嵌入式系统原理与应用
>
> 表3-4 EPSR寄存器位定义
>
> 中断屏蔽寄存器组包含3个寄存器,用于控制异常的使能和禁用。只有在特权模式下,
> 允许访问这3个寄存器,这3个寄存器的功能描述见表3-5。
>
> 表3-5中断屏蔽寄存器组功能
>
> 控制寄存器用于定义特权级别,主要用于选择当前使用哪个堆栈指针,控制寄存器位定义
> 表3-6控制寄存器位定义
>
> 如表3-6所示。

+------------------+--------------------------------+------------------+
|                  | > 一功能                       |                  |
|                  | >                              |                  |
|                  | > 堆 栈 指 针 选 择 。 (       |                  |
|                  | > )一选                        |                  |
|                  | 择主堆栈指针MSP(复位后缺省值)  |                  |
|                  | > : 1- 选择进程堆栈            |                  |
+------------------+--------------------------------+------------------+
| > CONTROLII      |                                |                  |
+------------------+--------------------------------+------------------+
| > CONTROLOT      | > 指针PSP) -0                  | Handler模        |
|                  | > 一特权级的线程模式.          | 式永远都是特权级 |
|                  | > 1一用户级的线程模式:         |                  |
+------------------+--------------------------------+------------------+
|                  |                                |                  |
+------------------+--------------------------------+------------------+

> 3.3 STM32F407总线和存储器结构
>
> ![](media/image25.jpeg)
>
> 44
>
> 整个系统架构由多层32位AHB总线及主从总线构成,并建立起各个主从模块间的互耶

访问

3.3.1 总线结构

> 1\. AMBA (Advanced Microprocessor Bus Architecture)

AMBA是ARM公司提出的一种开放性的SoC总线标准,现在已经被广泛地应用于RISC
的内核上了。AMBA定义了一种多总线系统(multilevel busing
system),包括系统总线和外设总
线。AMBA支持32位、64位、128位的数据总线和32位的地址总线,同时支持byte和halfword
设计。

> AMBA定义了两种总线: AHB(Advanced High-performance
> Bus)先进的高性能总线,也 叫做ASB(Advanced System Bus)。 APB(Advanced
> peripheral Bus)先进的外设总线。

AHB和ASB都是一类高速总线,主要负责嵌入式处理器、DMA控制器、Memory等的
接口。
APB是低速总线,主要负责外设接口。AHB和APB之间是通过Bridge(桥接器)连接
的。一个系统中的各个模块之间相互通信是通过总线来实现的。总线的作用就是把数据和地址
从设备A搬运到设备B上。

> 2\. STM32F4的总线架构

![](media/image26.jpeg)

> 图3.8 STM32F4的总线架构图
>
> 总线矩阵跟图中上方的6条主控总线和右方的5条被控总线保持互联。总线矩阵用于主书
> 总线之间的访问仲裁管理,仲裁采用循环调度算法。

(1)六条主控总线: 0内核1总线、D总线和s总线; 2 DMA1存储器; 3 DMA2有
储器；④DMA2外设。

> (2)五条被控总线: 0内部Flash ICode总线; 2内部Flash DCode总线; 3主要内
>
> 45

![](media/image27.jpeg)

![](media/image28.jpeg)

> 嵌入式系统原理与应用
>
> 1.内置SDAM
>
> STM32F40x内置了4KB的备份SRAM和192KB的系统SRAM,系统SRAM可按字节、
> 半字(16位)或全字(32位)访问,数据字节以小端模式存放在存储器中,即一个字里的低字节数
> 据存放在低地址位置,字里的高字节存放在高地址位置。SRAM的起始地址是0x2000000
> 可以以CPU的速度为0等待对SRAM进行读写操作。
>
> 系统SRAM被分成三块,112KB.64KB和16KB.CPU可以通过系统总线访问系统SRAM,
> 或者选择从SRAM中启动,或者选择物理重映射通过指令访问。
>
> 2.内置Flash存储器
>
> Flash存储器将整个存储区分为4个16KB、1个64KB和7个128KB,可在设备选择系统
> 内存引导模式时作为系统内存。
>
> Flash接口可管理CPU通过AHB
> I-Code和D-Code对Flash进行的访问。该接口可针对
> Flash执行擦除和编程操作,并实施读写保护机制。Flash接口通过指令预取和缓存机制加速代
> 码执行。系统架构内的Flash接口连接如图3.11所示。
>
> ![IMAGE](media/image29.jpeg){width="4.958333333333333in"
> height="3.1527777777777777in"}
>
> 器
>
> 图3.11 系统架构内的Flash接口连接图
>
> 根据STM32的内存映射图,在代码区, 0x000000地址为启动区,上电以后, CPU从
> 这个地址开始执行代码。0x08000000是用户FLASH的起始地址;
> 0x20000000是SRAM的起 始地址
>
> 3.3.3 位段
>
> Cortex-M4F核存储器映射包括两个位段区域。SRAM区的最低1MB空间和外设存储区
> 的最低1MB空间,并且分别被映射到两个32 MB的位段别名区域。
>
> 位段区中的每一位映射到位段别名区中的一个字。通过对别名区中某个字的读写操作可以
>
> 48

+-------------------+---------------+----------------------------------+
| > 也址范目        | > 存储器区域  | > 指令和数据存取                 |
+-------------------+---------------+----------------------------------+
| > 0x2             | >             | > 可以像                         |
| 0000000-0x200FFFF |  SRAM位段区域 | 访问SRAM存储器那样直接访问此存储 |
| > (220-1MB)       |               | > 器区域,但是                    |
|                   |               | 此区域也可以使用位段别名按位寻址 |
+-------------------+---------------+----------------------------------+
| > 0x2             | > SRA         | > 本区域的数                     |
| 2000000-0x23FFFFF | M位段别名区域 | 据存取将被映射到位段区域。写操作 |
| > (225 32MB)      |               | > 相当于读一                     |
|                   |               | 改一写操作。指令存取不会被重映射 |
+-------------------+---------------+----------------------------------+

> 访问映射到1 MB外设位段区域的32MB外设别名区域,对应关系见表3-8。
> 表3-8外设位段与位段别名区映身
>
> 0x40000000-0x400FFFF)
> 外设位段区填可以像访问外设寄存器那样直接访问此存储器区 (220-=1MB)
> 域,但是此区域也可以使用位段别名按位寻址
>
> 注意:位段传输的大小与指令规定的传输大小相匹配,可以为字节、半字或字。这两个别
> 名区域位于存储器映射图中的保留区域,因此说只有位段区域映射到别名区域,而没有存储器
> 映射到别名区域
>
> 位段别名区中的字与位段区的位映射公式:
>
> bit word addr bit band base + (byte offset x 32) + (bit number x 4)
> 其中，
>
> bit word addr代表别名区域中将映射到目标位的字的地址;
>
> bit band base代表别名区域的起始地址:
>
> byte offist代表目标位所在位段区域中的字节编号;
>
> bitnumber代表目标位的位位置(0-7)。
>
> 例如:
> SRAM位段区中地址为0x20000500的字节中的位2被映射到别名区中的地址为
>
> 0x22000000+(0x500\*32) +2\*4-0x2200A008
>
> 这个例子也说明了对0x2200A008地址的写操作与对SRAM中地址0x20000500字节的位
> 2执行读一改一写操作有着相同的效果。
>
> 注意:基地址0x2200000于操作内置RAM,基地址0x42000000于操作内置外设
> 基地址0x2200000和基地址0x42000000固定在芯片中,是固定不变的两个地址。
>
> 3.4 时钟电路、复位电路、启动配置
>
> 3.4.1 时钟控制
>
> STM32的时钟产生方式分为内部时钟产生方式(芯片内部R/C震荡电路)和外部时钟产生
> 方式(外部晶振电路)两种
>
> 内部时钟产生方式又分为高速内部(HS) RC振荡器和低速内部(LSI)
> RC振荡器两种,这
> 两个振荡器分别产生两组时钟信号。HSI的频率典型值是8MHz,精度典型值是1%,最差值
>
> 嵌入式系统原理与应用
>
> 是2.5%,
> LSI的输出频率典型值是40KHz,最小值是30kHz,最大值是60kHz。由此可以看出,
> 内部时钟不论是高速还是低速,其精度误差均较大,因此在对于时钟精度要求比较高的场合,
> ,般都不采用内部时钟,而选择外部时钟源
>
> STM32的外部时钟源可以接高速(HSE)和低速(LSE)两组外部时钟。HSE频率的取值范
> 围在0-25MHz,精度取决于选择的晶体振荡电路。LSE频率的取值范围在0-1000kHz,目的
> 是为了生成准确的申行异步通信的波特率,一般频率的典型值为32.768Hz。
>
> 在STM32F4中,有5个重要的时钟源,为HSI、 HSE, LSI, LSE、 PLL。其中, PLL实
> 际是分为两个时钟源,分别为主PLL和专用PLL
>
> 从时钟频率来分可以分为高速时钟源和低速时钟源。在这5个时钟源中HSI,
> HSE以及 PLL是高速时钟, LSI和LSE是低速时钟。
>
> 从来源可分为外部时钟源和内部时钟源。外部时钟源就是从外部通过接晶振的方式获取时
> 钟源,其中,
> HSE和LSE是外部时钟源,其他的是内部时钟源。系统时钟图见实时时钟部分
>
> 的内容
>
> 在STM32F407中,系统所有外设的时钟均是通过系统时钟源(SYSCLK)来提供的,就是
> 说经常用到的外设时钟,都是通过SYSCLK分频得到的。SYSCLK相关的时钟如图3.12所示
>
> \|HSI
>
> HSE
>
> TPLLCK
>
> AНB RESO

SYSCLK 高高168 MH2A

> 图3.12 SYSCLK时钟图
>
> 由图中可以看到, SYSCLK的来源主要有三个: 0 HSI(high speed
> inner)振荡器时钟: 2 HSE (high speed outer)振荡器时钟; 3
> PLL(锁相环倍频输出)主时钟。
>
> 1,高速外部时钟HSE(4M\~26M)
>
> 高速外部时钟是芯片内部的HSE振荡器产生的。高速外部信号(HSE)有两个时钟源,一个是
> 外部晶振,通过在OSC IN和OSC
> OUT接入外部晶振实现的;一个是外部用户时钟,通过OSC IN
> 引脚输入一个外部时钟源,这个时钟源是外部产生的现成的时钟信号,如图3.13所示,

+------------+-----------------------+-------+-----+---+---+-----------+
|            |                       | > 硬  |     |   |   |           |
|            |                       | 件配  |     |   |   |           |
+------------+-----------------------+-------+-----+---+---+-----------+
|            |                       | >     |     |   |   |           |
|            |                       | Osc_u |     |   |   |           |
+------------+-----------------------+-------+-----+---+---+-----------+
| > 外部耐   |                       |       | >   |   |   |           |
|            |                       |       | HZ) |   |   |           |
+------------+-----------------------+-------+-----+---+---+-----------+
|            | > 外部源              |       |     |   |   |           |
+------------+-----------------------+-------+-----+---+---+-----------+
|            |                       | > LIN |     |   |   |           |
|            |                       | > OSC |     |   |   |           |
|            |                       | > OUT |     |   |   |           |
+------------+-----------------------+-------+-----+---+---+-----------+
| > 最振/    |                       |       |     |   | > |           |
| 陶密消振書 |                       |       |     |   |   |           |
|            |                       |       |     |   | \ |           |
|            |                       |       |     |   | - |           |
+------------+-----------------------+-------+-----+---+---+-----------+
|            |                       | >     |     | > | > | ਨ         |
|            |                       |  负载 |     |   |   |           |
|            |                       | 电容  |     | c | 7 |           |
|            |                       |       |     | e |   |           |
+------------+-----------------------+-------+-----+---+---+-----------+

> 图3.13 HSE振荡器产生方式图
>
> 50
>
> 第3章STM32F407单片机
>
> 2,高速内部时钟HSI
>
> STM32F407内部自带一个16M的内部晶振,这个晶振产生的时钟信号可以直接用作系乡
> 时钟SYSCLK,也可以作为PLL的输入。内部晶振的优点是成本低,启动速度也比外部晶振
> 要快,缺点是内部晶振的精度比外部晶振要差。它可以通过RCC时钟控制寄存器(RCC
> CRI 中的HSIRDY标志来判断HSI RC时钟信号是否稳定。
>
> 3\. PLL主时钟
>
> STM32F407具有两个PLL,用于产生不同的时钟信号。主PLL(PLL)由HSE或者HSI提
> 供时钟信号,并具有两个不同的输出时钟。第一个输出PLLP用于生成高速的系统时钟(最高
> 168MH2),第二个输出PLLQ用于生成USB OTG
> FS的时钟(48MHz)、随机数发生器的时钟和
> SDIO时钟。专用PLL(PLLI2S)用于生成精确时钟,从而在12s接口实现高品质音频性能。PLI
>
> ![](media/image30.jpeg)
>
> 图3.14 PLL时钟内部结构图

STM32F4的系统时钟非常重要,涉及整个系统的运行结果。无论是什么操作,都需要时
钟信号,不同型号的微控制器的默认系统时钟配置是不同,具体配置参考系统启动文件;
startup_stm32f4xx.S

3.4.2复位

复位电路的作用是为了是系统恢复到初始状态的。对于STM32单片机来说,它支持三种
复位形式,分别为系统复位、上电复位和备份区域复位。其芯片内部的复位电路结构如图3.1

![](media/image31.jpeg)

> 嵌入式系统原理与应用
>
> (1)电源复位:其产生的条件是,当系统上电、掉电,以及系统从待机模式返回时,发生
> 电源复位。电源复位能够复位除了备份区域寄存器之外的所有寄存器的状态
>
> (2)系统复位:以下任一事件发生时,均能产生一个系统复位:
>
> 1\) NRST引脚上的低电平(外部复位);
>
> 2)窗口看门狗计数终止(WWDG复位);
>
> 3)独立看门狗计数终止(IWDG复位);
>
> 4)软件复位(sw复位)
>
> 5)低功耗管理复位。
>
> 系统复位能够复位除时钟控制寄存器CRS中的复位标志和备份区域中的寄存器之外的所
> 有寄存器
>
> (3)备份区域复位:对于备份区域的复位,一种是在软件复位的时候设定备份区域控制寄
> 器中的对应位产生的;另一种是当电源和电池都掉电又重新上电时产生的。
>
> 对于常用的复位电路,其实对应的都是系统复位中的第一个条件,即令NRST引脚上的
> 来一个低电平信号(外部复位)引发系统复位。常用的复位电路图如图3.16所示。
>
> ![IMAGE](media/image32.jpeg){width="4.291666666666667in"
> height="1.2916666666666667in"}
>
> 图3.16 系统复位电路图
>
> 具体工作过程:当RESET按键按下时,
> NRST引脚和地相接,从而被拉低,产生一个低电
> 平信号,实现复位。系统上电瞬间,电容充电导致NRST在上电瞬间被拉为低电平信号,这个
> 信号持续1100us的时间(时间计算公式:
> t-1.1RC1.10020.000001F-0015-1100us),而
> 这个时间对于STM32的NRST所需要的低电平信号时长,所以,可以满足复位要求
>
> 3.4.3 启动配置
>
> 由于固定的存储器映射, STM32从0x000000X03FFFFF这段地址空间称为自举有
> 诸空间,代码区的起始地址是0x00000000通过ICode/DCode总线访问,数据区SRAM的起
> 哈地址为0x20000000通过系统总线访问。Cortex-M4FCPU通过ICode总线从地址0000
> 获取栈顶值,然后从始于0x0000
> 000的存储器开始执行代码。在单片机上电之前是没有存储
> 器映射到这段自举存储空间内的。STM32F407单片机上电之后通过硬件检测相应的BOOT
> 引
> 脚来确定将自举存储空间映射到主Flash,系统存储器还是嵌入式SRAM.在STM32F4xx中,
> 可通过BOOT\[1:0\]引脚选择三种不同的自举模式,见表3-9。
>
> 复位后,在系统时钟(SYSCLK)的第四个上升沿锁存BOOT引脚的值。复位后,用户可
> 以通过设置BOOTI和BOOTO引脚来选择需要的自举模式。
>
> 2
>
> 第3章 STM32F407单片机

+---------+-----------+--------------+---+---+-----------+-------------+
|         |           | > 表3-9      |   |   |           |             |
|         |           | > 自举模式   |   |   |           |             |
+---------+-----------+--------------+---+---+-----------+-------------+
| > 白举  |           | > 自举模式   |   |   | >         |             |
| 模式选  |           |              |   |   |  自举空间 |             |
| 择引脚  |           |              |   |   |           |             |
+---------+-----------+--------------+---+---+-----------+-------------+
| > воото | > BOоTI   |              |   |   |           |             |
+---------+-----------+--------------+---+---+-----------+-------------+
|         |           | > 主Flash    |   | 选 |          |             |
|         |           |              |   | 择 |          |             |
|         |           |              |   | 从 |          |             |
|         |           |              |   | 主 |          |             |
|         |           |              |   | F |           |             |
|         |           |              |   | l |           |             |
|         |           |              |   | a |           |             |
|         |           |              |   | s |           |             |
|         |           |              |   | h |           |             |
|         |           |              |   | 存 |          |             |
|         |           |              |   | 储 |          |             |
|         |           |              |   | 器 |          |             |
|         |           |              |   | 作 |          |             |
|         |           |              |   | 为 |          |             |
|         |           |              |   | 自 |          |             |
|         |           |              |   | 举 |          |             |
|         |           |              |   | 空 |          |             |
|         |           |              |   | 间 |          |             |
+---------+-----------+--------------+---+---+-----------+-------------+
|         |           | > 系统存储器 |   |   | 选择      |             |
|         |           |              |   |   | 从系统存  |             |
|         |           |              |   |   | 储器作为  |             |
|         |           |              |   |   | 自举空间  |             |
+---------+-----------+--------------+---+---+-----------+-------------+
|         |           | > 内置SRAM   |   | > | > 择从    | 作为自举空i |
|         |           |              |   |   | 内置SRAM  |             |
|         |           |              |   | 选 |          |             |
+---------+-----------+--------------+---+---+-----------+-------------+
| > 3.5   |           |              |   |   |           |             |
| > 最    |           |              |   |   |           |             |
| 小系统  |           |              |   |   |           |             |
| >       |           |              |   |   |           |             |
| STM32的 |           |              |   |   |           |             |
| 最小系  |           |              |   |   |           |             |
| 统主要  |           |              |   |   |           |             |
| 由电源  |           |              |   |   |           |             |
| 电路、  |           |              |   |   |           |             |
| 时钟源  |           |              |   |   |           |             |
| 电路、  |           |              |   |   |           |             |
| BOOT启  |           |              |   |   |           |             |
| 动电路  |           |              |   |   |           |             |
| 、调试  |           |              |   |   |           |             |
| 接口电  |           |              |   |   |           |             |
| 路和复  |           |              |   |   |           |             |
+---------+-----------+--------------+---+---+-----------+-------------+

> 位电路五个部分组成。
>
> (1)电源电路(用于供电,一般用电脑的USB口供电),
> 3.3V的电源从这里接入,其中,电 容起到滤波的作用。电路如图3.17所示。
>
> 图3.17 电源电路
>
> (2)时钟源电路。晶振的作用是为最小系统提供最基本的时钟信号,电容的作用是保证晶
> 振输出的振荡频率更加稳定。晶振的大小由单片机时钟周期要求而决定(用于计时,与两个电
> 容并联使用,电容大小由晶振决定,一般用22pF) 。电路如图3.18所示。
>
> ![IMAGE](media/image33.jpeg){width="4.125in"
> height="1.3472222222222223in"}
>
> 图3.18时钟源电路图
>
> (3)复位电路。STM32有三种复位方式,采用电源复位的方式,当RESET按键被按下时,
> RESET引脚被拉低产生外部复位时,产生复位脉冲,从而使系统复位,复位电路如图3.19所示。-
>
> VCC3.3.v
>
> LR32
>
> ![](media/image34.jpeg)
>
> GND 图3.19复位电路
>
> 嵌入式系统原理与应用
>
> \(4\) BOOT启动电路。STM32有三种启动模式,由BOOTO和BOOT1引脚在复位时的冰
> 态决定,启动模式如表3-10所示。

+----------+---------+------------------+-----------------------------+
|          |         | > 表3-10         |                             |
|          |         | > STM32启动模式  |                             |
+----------+---------+------------------+-----------------------------+
| > BOOTΟ  |         | > BOOTΙ          | > 启动模式                  |
+----------+---------+------------------+-----------------------------+
|          | > )     |                  | > 从主闪存存储器启动        |
+----------+---------+------------------+-----------------------------+
|          |         |                  | > 从系统存储器启动          |
+----------+---------+------------------+-----------------------------+
|          |         |                  | > 从内置SRAM启动            |
+----------+---------+------------------+-----------------------------+

> 注意: M4在上述基础上又增加了可在FSMC的BANK1区域启动。
>
> -般使用JTAG或者SWD调试下载程序,会下载到闪存里,所以可以直接将BOOTO引
> 脚和BOOT1引脚置为低电平。电路图如3.20所示。
>
> (5)调试接口电路。常用的调试下载方式有JTAG和SWD, JTAG为5针,
> SWD为2线串行, 采用SWD调试接口,直接将SWCLK. SWDIO. GND,
> 3.3V引脚引出即可,如图3.21所示.
>
> ![](media/image35.jpeg)
>
> 图3.20 BOOT启动模式电路图 图3.21 swD调试接口电路图
>
> 将电源电路、时钟源电路、BOOT启动电路、调试接口电路、复位电路与STM32F407单
> 机进行电路连接,就可以组成STM32F407单片机的最小系统,让其正常工作。
>
> 本章小结
>
> 本章主要介绍了STM32F407单片机的组成,处理器的寄存器组,总线结构、存储器结构
> 位段,STM32F407单片机的时钟电路、复位电路及其启动配置等方面,这些构成了STM32F407
> 单片机最小系统。寄存器为后续ARM汇编程序设计的学习奠定了基础。
>
> 习题
>
> 1\. ARM公司提出的AMBA总线标准,包括哪两类总线,它们各自的功能是什么?
>
> 2.简述ARM Cortex-M4通用寄存器的名称及功能
>
> 3,简述STM32系列处理器将可访问的存储器被分为几大主块,每块的大小及功能。
>
> 4\.
> Cortex-M4F核存储器映射包括哪两个位段区域,位段别名区中的字与位段区的位映
> 射关系式是什么?计算外设位段区中地址为0x40000900的字节中的位3被映射到别名区中的
> 地址为多少？
>
> 5.简述STM32F407单片机的启动模式有哪些状态。
>
> 6,简述STM32F407单片机的最小系统组成。
>
> 54
